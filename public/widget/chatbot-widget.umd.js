(function(j,Mt){typeof exports=="object"&&typeof module<"u"?Mt(require("react"),require("react-dom")):typeof define=="function"&&define.amd?define(["react","react-dom"],Mt):(j=typeof globalThis<"u"?globalThis:j||self,Mt(j.React,j.ReactDOM))})(this,function(j,Mt){"use strict";function Lo(n){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(n){for(const t in n)if(t!=="default"){const r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:()=>n[t]})}}return e.default=n,Object.freeze(e)}const we=Lo(j);var Ee=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ns(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Fo(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var an={exports:{}},Nt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ls;function Uo(){if(Ls)return Nt;Ls=1;var n=j,e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function a(o,c,l){var u,h={},f=null,m=null;l!==void 0&&(f=""+l),c.key!==void 0&&(f=""+c.key),c.ref!==void 0&&(m=c.ref);for(u in c)r.call(c,u)&&!i.hasOwnProperty(u)&&(h[u]=c[u]);if(o&&o.defaultProps)for(u in c=o.defaultProps,c)h[u]===void 0&&(h[u]=c[u]);return{$$typeof:e,type:o,key:f,ref:m,props:h,_owner:s.current}}return Nt.Fragment=t,Nt.jsx=a,Nt.jsxs=a,Nt}var Lt={},Fs;function Bo(){if(Fs)return Lt;Fs=1;var n={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */return n.NODE_ENV!=="production"&&function(){var e=j,t=Symbol.for("react.element"),r=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),p=Symbol.for("react.offscreen"),g=Symbol.iterator,_="@@iterator";function T(d){if(d===null||typeof d!="object")return null;var y=g&&d[g]||d[_];return typeof y=="function"?y:null}var w=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function S(d){{for(var y=arguments.length,v=new Array(y>1?y-1:0),R=1;R<y;R++)v[R-1]=arguments[R];b("error",d,v)}}function b(d,y,v){{var R=w.ReactDebugCurrentFrame,q=R.getStackAddendum();q!==""&&(y+="%s",v=v.concat([q]));var z=v.map(function(U){return String(U)});z.unshift("Warning: "+y),Function.prototype.apply.call(console[d],console,z)}}var E=!1,k=!1,x=!1,W=!1,B=!1,I;I=Symbol.for("react.module.reference");function D(d){return!!(typeof d=="string"||typeof d=="function"||d===s||d===a||B||d===i||d===u||d===h||W||d===p||E||k||x||typeof d=="object"&&d!==null&&(d.$$typeof===m||d.$$typeof===f||d.$$typeof===o||d.$$typeof===c||d.$$typeof===l||d.$$typeof===I||d.getModuleId!==void 0))}function _e(d,y,v){var R=d.displayName;if(R)return R;var q=y.displayName||y.name||"";return q!==""?v+"("+q+")":v}function ue(d){return d.displayName||"Context"}function se(d){if(d==null)return null;if(typeof d.tag=="number"&&S("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case s:return"Fragment";case r:return"Portal";case a:return"Profiler";case i:return"StrictMode";case u:return"Suspense";case h:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case c:var y=d;return ue(y)+".Consumer";case o:var v=d;return ue(v._context)+".Provider";case l:return _e(d,d.render,"ForwardRef");case f:var R=d.displayName||null;return R!==null?R:se(d.type)||"Memo";case m:{var q=d,z=q._payload,U=q._init;try{return se(U(z))}catch{return null}}}return null}var ce=Object.assign,We=0,Xe,le,Rt,It,C,O,G;function he(){}he.__reactDisabledLog=!0;function en(){{if(We===0){Xe=console.log,le=console.info,Rt=console.warn,It=console.error,C=console.group,O=console.groupCollapsed,G=console.groupEnd;var d={configurable:!0,enumerable:!0,value:he,writable:!0};Object.defineProperties(console,{info:d,log:d,warn:d,error:d,group:d,groupCollapsed:d,groupEnd:d})}We++}}function Cs(){{if(We--,We===0){var d={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:ce({},d,{value:Xe}),info:ce({},d,{value:le}),warn:ce({},d,{value:Rt}),error:ce({},d,{value:It}),group:ce({},d,{value:C}),groupCollapsed:ce({},d,{value:O}),groupEnd:ce({},d,{value:G})})}We<0&&S("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var jt=w.ReactCurrentDispatcher,As;function tn(d,y,v){{if(As===void 0)try{throw Error()}catch(q){var R=q.stack.trim().match(/\n( *(at )?)/);As=R&&R[1]||""}return`
`+As+d}}var Ts=!1,rn;{var ef=typeof WeakMap=="function"?WeakMap:Map;rn=new ef}function Eo(d,y){if(!d||Ts)return"";{var v=rn.get(d);if(v!==void 0)return v}var R;Ts=!0;var q=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var z;z=jt.current,jt.current=null,en();try{if(y){var U=function(){throw Error()};if(Object.defineProperty(U.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(U,[])}catch(ye){R=ye}Reflect.construct(d,[],U)}else{try{U.call()}catch(ye){R=ye}d.call(U.prototype)}}else{try{throw Error()}catch(ye){R=ye}d()}}catch(ye){if(ye&&R&&typeof ye.stack=="string"){for(var N=ye.stack.split(`
`),de=R.stack.split(`
`),X=N.length-1,Z=de.length-1;X>=1&&Z>=0&&N[X]!==de[Z];)Z--;for(;X>=1&&Z>=0;X--,Z--)if(N[X]!==de[Z]){if(X!==1||Z!==1)do if(X--,Z--,Z<0||N[X]!==de[Z]){var ke=`
`+N[X].replace(" at new "," at ");return d.displayName&&ke.includes("<anonymous>")&&(ke=ke.replace("<anonymous>",d.displayName)),typeof d=="function"&&rn.set(d,ke),ke}while(X>=1&&Z>=0);break}}}finally{Ts=!1,jt.current=z,Cs(),Error.prepareStackTrace=q}var Dt=d?d.displayName||d.name:"",lt=Dt?tn(Dt):"";return typeof d=="function"&&rn.set(d,lt),lt}function tf(d,y,v){return Eo(d,!1)}function rf(d){var y=d.prototype;return!!(y&&y.isReactComponent)}function nn(d,y,v){if(d==null)return"";if(typeof d=="function")return Eo(d,rf(d));if(typeof d=="string")return tn(d);switch(d){case u:return tn("Suspense");case h:return tn("SuspenseList")}if(typeof d=="object")switch(d.$$typeof){case l:return tf(d.render);case f:return nn(d.type,y,v);case m:{var R=d,q=R._payload,z=R._init;try{return nn(z(q),y,v)}catch{}}}return""}var dr=Object.prototype.hasOwnProperty,xo={},ko=w.ReactDebugCurrentFrame;function sn(d){if(d){var y=d._owner,v=nn(d.type,d._source,y?y.type:null);ko.setExtraStackFrame(v)}else ko.setExtraStackFrame(null)}function nf(d,y,v,R,q){{var z=Function.call.bind(dr);for(var U in d)if(z(d,U)){var N=void 0;try{if(typeof d[U]!="function"){var de=Error((R||"React class")+": "+v+" type `"+U+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof d[U]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw de.name="Invariant Violation",de}N=d[U](y,U,R,v,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(X){N=X}N&&!(N instanceof Error)&&(sn(q),S("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",R||"React class",v,U,typeof N),sn(null)),N instanceof Error&&!(N.message in xo)&&(xo[N.message]=!0,sn(q),S("Failed %s type: %s",v,N.message),sn(null))}}}var sf=Array.isArray;function Rs(d){return sf(d)}function af(d){{var y=typeof Symbol=="function"&&Symbol.toStringTag,v=y&&d[Symbol.toStringTag]||d.constructor.name||"Object";return v}}function of(d){try{return Oo(d),!1}catch{return!0}}function Oo(d){return""+d}function Po(d){if(of(d))return S("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",af(d)),Oo(d)}var fr=w.ReactCurrentOwner,cf={key:!0,ref:!0,__self:!0,__source:!0},Co,Ao,Is;Is={};function lf(d){if(dr.call(d,"ref")){var y=Object.getOwnPropertyDescriptor(d,"ref").get;if(y&&y.isReactWarning)return!1}return d.ref!==void 0}function uf(d){if(dr.call(d,"key")){var y=Object.getOwnPropertyDescriptor(d,"key").get;if(y&&y.isReactWarning)return!1}return d.key!==void 0}function hf(d,y){if(typeof d.ref=="string"&&fr.current&&y&&fr.current.stateNode!==y){var v=se(fr.current.type);Is[v]||(S('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',se(fr.current.type),d.ref),Is[v]=!0)}}function df(d,y){{var v=function(){Co||(Co=!0,S("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",y))};v.isReactWarning=!0,Object.defineProperty(d,"key",{get:v,configurable:!0})}}function ff(d,y){{var v=function(){Ao||(Ao=!0,S("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",y))};v.isReactWarning=!0,Object.defineProperty(d,"ref",{get:v,configurable:!0})}}var mf=function(d,y,v,R,q,z,U){var N={$$typeof:t,type:d,key:y,ref:v,props:U,_owner:z};return N._store={},Object.defineProperty(N._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(N,"_self",{configurable:!1,enumerable:!1,writable:!1,value:R}),Object.defineProperty(N,"_source",{configurable:!1,enumerable:!1,writable:!1,value:q}),Object.freeze&&(Object.freeze(N.props),Object.freeze(N)),N};function gf(d,y,v,R,q){{var z,U={},N=null,de=null;v!==void 0&&(Po(v),N=""+v),uf(y)&&(Po(y.key),N=""+y.key),lf(y)&&(de=y.ref,hf(y,q));for(z in y)dr.call(y,z)&&!cf.hasOwnProperty(z)&&(U[z]=y[z]);if(d&&d.defaultProps){var X=d.defaultProps;for(z in X)U[z]===void 0&&(U[z]=X[z])}if(N||de){var Z=typeof d=="function"?d.displayName||d.name||"Unknown":d;N&&df(U,Z),de&&ff(U,Z)}return mf(d,N,de,q,R,fr.current,U)}}var js=w.ReactCurrentOwner,To=w.ReactDebugCurrentFrame;function $t(d){if(d){var y=d._owner,v=nn(d.type,d._source,y?y.type:null);To.setExtraStackFrame(v)}else To.setExtraStackFrame(null)}var $s;$s=!1;function Ds(d){return typeof d=="object"&&d!==null&&d.$$typeof===t}function Ro(){{if(js.current){var d=se(js.current.type);if(d)return`

Check the render method of \``+d+"`."}return""}}function pf(d){return""}var Io={};function _f(d){{var y=Ro();if(!y){var v=typeof d=="string"?d:d.displayName||d.name;v&&(y=`

Check the top-level render call using <`+v+">.")}return y}}function jo(d,y){{if(!d._store||d._store.validated||d.key!=null)return;d._store.validated=!0;var v=_f(y);if(Io[v])return;Io[v]=!0;var R="";d&&d._owner&&d._owner!==js.current&&(R=" It was passed a child from "+se(d._owner.type)+"."),$t(d),S('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',v,R),$t(null)}}function $o(d,y){{if(typeof d!="object")return;if(Rs(d))for(var v=0;v<d.length;v++){var R=d[v];Ds(R)&&jo(R,y)}else if(Ds(d))d._store&&(d._store.validated=!0);else if(d){var q=T(d);if(typeof q=="function"&&q!==d.entries)for(var z=q.call(d),U;!(U=z.next()).done;)Ds(U.value)&&jo(U.value,y)}}}function yf(d){{var y=d.type;if(y==null||typeof y=="string")return;var v;if(typeof y=="function")v=y.propTypes;else if(typeof y=="object"&&(y.$$typeof===l||y.$$typeof===f))v=y.propTypes;else return;if(v){var R=se(y);nf(v,d.props,"prop",R,d)}else if(y.PropTypes!==void 0&&!$s){$s=!0;var q=se(y);S("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",q||"Unknown")}typeof y.getDefaultProps=="function"&&!y.getDefaultProps.isReactClassApproved&&S("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function wf(d){{for(var y=Object.keys(d.props),v=0;v<y.length;v++){var R=y[v];if(R!=="children"&&R!=="key"){$t(d),S("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",R),$t(null);break}}d.ref!==null&&($t(d),S("Invalid attribute `ref` supplied to `React.Fragment`."),$t(null))}}var Do={};function Mo(d,y,v,R,q,z){{var U=D(d);if(!U){var N="";(d===void 0||typeof d=="object"&&d!==null&&Object.keys(d).length===0)&&(N+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var de=pf();de?N+=de:N+=Ro();var X;d===null?X="null":Rs(d)?X="array":d!==void 0&&d.$$typeof===t?(X="<"+(se(d.type)||"Unknown")+" />",N=" Did you accidentally export a JSX literal instead of a component?"):X=typeof d,S("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",X,N)}var Z=gf(d,y,v,q,z);if(Z==null)return Z;if(U){var ke=y.children;if(ke!==void 0)if(R)if(Rs(ke)){for(var Dt=0;Dt<ke.length;Dt++)$o(ke[Dt],d);Object.freeze&&Object.freeze(ke)}else S("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else $o(ke,d)}if(dr.call(y,"key")){var lt=se(d),ye=Object.keys(y).filter(function(kf){return kf!=="key"}),Ms=ye.length>0?"{key: someKey, "+ye.join(": ..., ")+": ...}":"{key: someKey}";if(!Do[lt+Ms]){var xf=ye.length>0?"{"+ye.join(": ..., ")+": ...}":"{}";S(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Ms,lt,xf,lt),Do[lt+Ms]=!0}}return d===s?wf(Z):yf(Z),Z}}function bf(d,y,v){return Mo(d,y,v,!0)}function vf(d,y,v){return Mo(d,y,v,!1)}var Sf=vf,Ef=bf;Lt.Fragment=s,Lt.jsx=Sf,Lt.jsxs=Ef}(),Lt}var Wo={};Wo.NODE_ENV==="production"?an.exports=Uo():an.exports=Bo();var A=an.exports,on,qo={},mr=Mt;if(qo.NODE_ENV==="production")on=mr.createRoot,mr.hydrateRoot;else{var Us=mr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;on=function(n,e){Us.usingClientEntryPoint=!0;try{return mr.createRoot(n,e)}finally{Us.usingClientEntryPoint=!1}}}/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ho={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jo=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),gr=(n,e)=>{const t=j.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:a,className:o="",children:c,...l},u)=>j.createElement("svg",{ref:u,...Ho,width:s,height:s,stroke:r,strokeWidth:a?Number(i)*24/Number(s):i,className:["lucide",`lucide-${Jo(n)}`,o].join(" "),...l},[...e.map(([h,f])=>j.createElement(h,f)),...Array.isArray(c)?c:[c]]));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vo=gr("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zo=gr("MessageSquarePlus",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M12 7v6",key:"lw1j43"}],["path",{d:"M9 10h6",key:"9gxzsh"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yo=gr("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Go=gr("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Ko=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(()=>ht).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class cn extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Xo extends cn{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Qo extends cn{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Zo extends cn{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var ln;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(ln||(ln={}));var ec=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((r=r.apply(n,e||[])).next())})};class tc{constructor(e,{headers:t={},customFetch:r,region:s=ln.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=Ko(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return ec(this,void 0,void 0,function*(){try{const{headers:s,method:i,body:a}=t;let o={},{region:c}=t;c||(c=this.region),c&&c!=="any"&&(o["x-region"]=c);let l;a&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",l=a):typeof a=="string"?(o["Content-Type"]="text/plain",l=a):typeof FormData<"u"&&a instanceof FormData?l=a:(o["Content-Type"]="application/json",l=JSON.stringify(a)));const u=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),s),body:l}).catch(p=>{throw new Xo(p)}),h=u.headers.get("x-relay-error");if(h&&h==="true")throw new Qo(u);if(!u.ok)throw new Zo(u);let f=((r=u.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),m;return f==="application/json"?m=yield u.json():f==="application/octet-stream"?m=yield u.blob():f==="text/event-stream"?m=u:f==="multipart/form-data"?m=yield u.formData():m=yield u.text(),{data:m,error:null}}catch(s){return{data:null,error:s}}})}}var fe={},un={},pr={},Ft={},_r={},yr={},rc=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ut=rc();const nc=ut.fetch,Bs=ut.fetch.bind(ut),Ws=ut.Headers,sc=ut.Request,ic=ut.Response,ht=Object.freeze(Object.defineProperty({__proto__:null,Headers:Ws,Request:sc,Response:ic,default:Bs,fetch:nc},Symbol.toStringTag,{value:"Module"})),ac=Fo(ht);var wr={};Object.defineProperty(wr,"__esModule",{value:!0});class oc extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}wr.default=oc;var qs=Ee&&Ee.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(yr,"__esModule",{value:!0});const cc=qs(ac),lc=qs(wr);let uc=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=cc.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var a,o,c;let l=null,u=null,h=null,f=i.status,m=i.statusText;if(i.ok){if(this.method!=="HEAD"){const T=await i.text();T===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=T:u=JSON.parse(T))}const g=(a=this.headers.Prefer)===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),_=(o=i.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");g&&_&&_.length>1&&(h=parseInt(_[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(l={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,f=406,m="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const g=await i.text();try{l=JSON.parse(g),Array.isArray(l)&&i.status===404&&(u=[],l=null,f=200,m="OK")}catch{i.status===404&&g===""?(f=204,m="No Content"):l={message:g}}if(l&&this.isMaybeSingle&&(!((c=l==null?void 0:l.details)===null||c===void 0)&&c.includes("0 rows"))&&(l=null,f=200,m="OK"),l&&this.shouldThrowOnError)throw new lc.default(l)}return{error:l,data:u,count:h,status:f,statusText:m}});return this.shouldThrowOnError||(s=s.catch(i=>{var a,o,c;return{error:{message:`${(a=i==null?void 0:i.name)!==null&&a!==void 0?a:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(o=i==null?void 0:i.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}};yr.default=uc;var hc=Ee&&Ee.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(_r,"__esModule",{value:!0});const dc=hc(yr);let fc=class extends dc.default{select(e){let t=!1;const r=(e??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:i=s}={}){const a=i?`${i}.order`:"order",o=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){const i=typeof s>"u"?"offset":`${s}.offset`,a=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(a,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:i=!1,format:a="text"}={}){var o;const c=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.Accept)!==null&&o!==void 0?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${l}"; options=${c};`,a==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};_r.default=fc;var mc=Ee&&Ee.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ft,"__esModule",{value:!0});const gc=mc(_r);let pc=class extends gc.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let i="";s==="plain"?i="pl":s==="phrase"?i="ph":s==="websearch"&&(i="w");const a=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};Ft.default=pc;var _c=Ee&&Ee.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(pr,"__esModule",{value:!0});const Ut=_c(Ft);let yc=class{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=t,this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let i=!1;const a=(e??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),r&&(this.headers.Prefer=`count=${r}`),new Ut.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const s="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const a=e.reduce((o,c)=>o.concat(Object.keys(c)),[]);if(a.length>0){const o=[...new Set(a)].map(c=>`"${c}"`);this.url.searchParams.set("columns",o.join(","))}}return new Ut.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:i=!0}={}){const a="POST",o=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&o.push(this.headers.Prefer),s&&o.push(`count=${s}`),i||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const c=e.reduce((l,u)=>l.concat(Object.keys(u)),[]);if(c.length>0){const l=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",l.join(","))}}return new Ut.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new Ut.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new Ut.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};pr.default=yc;var br={},vr={};Object.defineProperty(vr,"__esModule",{value:!0}),vr.version=void 0,vr.version="0.0.0-automated",Object.defineProperty(br,"__esModule",{value:!0}),br.DEFAULT_HEADERS=void 0;const wc=vr;br.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${wc.version}`};var Hs=Ee&&Ee.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(un,"__esModule",{value:!0});const bc=Hs(pr),vc=Hs(Ft),Sc=br;let Ec=class No{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},Sc.DEFAULT_HEADERS),t),this.schemaName=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new bc.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new No(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:s=!1,count:i}={}){let a;const o=new URL(`${this.url}/rpc/${e}`);let c;r||s?(a=r?"HEAD":"GET",Object.entries(t).filter(([u,h])=>h!==void 0).map(([u,h])=>[u,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([u,h])=>{o.searchParams.append(u,h)})):(a="POST",c=t);const l=Object.assign({},this.headers);return i&&(l.Prefer=`count=${i}`),new vc.default({method:a,url:o,headers:l,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}};un.default=Ec;var dt=Ee&&Ee.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(fe,"__esModule",{value:!0}),fe.PostgrestError=fe.PostgrestBuilder=fe.PostgrestTransformBuilder=fe.PostgrestFilterBuilder=fe.PostgrestQueryBuilder=fe.PostgrestClient=void 0;const Js=dt(un);fe.PostgrestClient=Js.default;const Vs=dt(pr);fe.PostgrestQueryBuilder=Vs.default;const zs=dt(Ft);fe.PostgrestFilterBuilder=zs.default;const Ys=dt(_r);fe.PostgrestTransformBuilder=Ys.default;const Gs=dt(yr);fe.PostgrestBuilder=Gs.default;const Ks=dt(wr);fe.PostgrestError=Ks.default;var xc=fe.default={PostgrestClient:Js.default,PostgrestQueryBuilder:Vs.default,PostgrestFilterBuilder:zs.default,PostgrestTransformBuilder:Ys.default,PostgrestBuilder:Gs.default,PostgrestError:Ks.default};const{PostgrestClient:kc,PostgrestQueryBuilder:Of,PostgrestFilterBuilder:Pf,PostgrestTransformBuilder:Cf,PostgrestBuilder:Af}=xc,Oc={"X-Client-Info":"realtime-js/2.10.7"},Pc="1.0.0",Xs=1e4,Cc=1e3;var ft;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(ft||(ft={}));var be;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(be||(be={}));var Oe;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Oe||(Oe={}));var hn;(function(n){n.websocket="websocket"})(hn||(hn={}));var Qe;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Qe||(Qe={}));class Ac{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),i=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=r.decode(e.slice(a,a+s));a=a+s;const c=r.decode(e.slice(a,a+i));a=a+i;const l=JSON.parse(r.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:c,payload:l}}}class Qs{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Y;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(Y||(Y={}));const Zs=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,a)=>(i[a]=Tc(a,n,e,s),i),{})},Tc=(n,e,t,r)=>{const s=e.find(o=>o.name===n),i=s==null?void 0:s.type,a=t[n];return i&&!r.includes(i)?ei(i,a):dn(a)},ei=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return $c(e,t)}switch(n){case Y.bool:return Rc(e);case Y.float4:case Y.float8:case Y.int2:case Y.int4:case Y.int8:case Y.numeric:case Y.oid:return Ic(e);case Y.json:case Y.jsonb:return jc(e);case Y.timestamp:return Dc(e);case Y.abstime:case Y.date:case Y.daterange:case Y.int4range:case Y.int8range:case Y.money:case Y.reltime:case Y.text:case Y.time:case Y.timestamptz:case Y.timetz:case Y.tsrange:case Y.tstzrange:return dn(e);default:return dn(e)}},dn=n=>n,Rc=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},Ic=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},jc=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},$c=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let i;const a=n.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>ei(e,o))}return n},Dc=n=>typeof n=="string"?n.replace(" ","T"):n,ti=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class fn{constructor(e,t,r={},s=Xs){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var ri;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(ri||(ri={}));class Bt{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Bt.syncState(this.state,s,i,a),this.pendingDiffs.forEach(c=>{this.state=Bt.syncDiff(this.state,c,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Bt.syncDiff(this.state,s,i,a),o())}),this.onJoin((s,i,a)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:a})}),this.onLeave((s,i,a)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const i=this.cloneDeep(e),a=this.transformState(t),o={},c={};return this.map(i,(l,u)=>{a[l]||(c[l]=u)}),this.map(a,(l,u)=>{const h=i[l];if(h){const f=u.map(_=>_.presence_ref),m=h.map(_=>_.presence_ref),p=u.filter(_=>m.indexOf(_.presence_ref)<0),g=h.filter(_=>f.indexOf(_.presence_ref)<0);p.length>0&&(o[l]=p),g.length>0&&(c[l]=g)}else o[l]=u}),this.syncDiff(i,{joins:o,leaves:c},r,s)}static syncDiff(e,t,r,s){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(o,c)=>{var l;const u=(l=e[o])!==null&&l!==void 0?l:[];if(e[o]=this.cloneDeep(c),u.length>0){const h=e[o].map(m=>m.presence_ref),f=u.filter(m=>h.indexOf(m.presence_ref)<0);e[o].unshift(...f)}r(o,u,c)}),this.map(a,(o,c)=>{let l=e[o];if(!l)return;const u=c.map(h=>h.presence_ref);l=l.filter(h=>u.indexOf(h.presence_ref)<0),e[o]=l,s(o,l,c),l.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ni;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(ni||(ni={}));var si;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(si||(si={}));var ii;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(ii||(ii={}));class mn{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=be.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new fn(this,Oe.join,this.params,this.timeout),this.rejoinTimer=new Qs(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=be.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=be.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=be.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=be.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Oe.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new Bt(this),this.broadcastEndpointURL=ti(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:a,private:o}}=this.params;this._onError(u=>e&&e("CHANNEL_ERROR",u)),this._onClose(()=>e&&e("CLOSED"));const c={},l={broadcast:i,presence:a,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&s!==void 0?s:[],private:o};this.socket.accessToken&&(c.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:l},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:u})=>{var h;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),u===void 0){e&&e("SUBSCRIBED");return}else{const f=this.bindings.postgres_changes,m=(h=f==null?void 0:f.length)!==null&&h!==void 0?h:0,p=[];for(let g=0;g<m;g++){const _=f[g],{filter:{event:T,schema:w,table:S,filter:b}}=_,E=u&&u[g];if(E&&E.event===T&&E.schema===w&&E.table===S&&E.filter===b)p.push(Object.assign(Object.assign({},_),{id:E.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,e&&e("SUBSCRIBED");return}}).receive("error",u=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:a}=e,o={method:"POST",headers:{Authorization:this.socket.accessToken?`Bearer ${this.socket.accessToken}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=c.body)===null||s===void 0?void 0:s.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,o,c;const l=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),l.receive("ok",()=>i("ok")),l.receive("error",()=>i("error")),l.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=be.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Oe.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const s=new fn(this,Oe.leave,{},e);s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}async _fetchWithTimeout(e,t,r){const s=new AbortController,i=setTimeout(()=>s.abort(),r),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),a}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new fn(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;const a=e.toLocaleLowerCase(),{close:o,error:c,leave:l,join:u}=Oe;if(r&&[o,c,l,u].indexOf(a)>=0&&r!==this._joinRef())return;let f=this._onMessage(a,t,r);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(m=>{var p,g,_;return((p=m.filter)===null||p===void 0?void 0:p.event)==="*"||((_=(g=m.filter)===null||g===void 0?void 0:g.event)===null||_===void 0?void 0:_.toLocaleLowerCase())===a}).map(m=>m.callback(f,r)):(i=this.bindings[a])===null||i===void 0||i.filter(m=>{var p,g,_,T,w,S;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in m){const b=m.id,E=(p=m.filter)===null||p===void 0?void 0:p.event;return b&&((g=t.ids)===null||g===void 0?void 0:g.includes(b))&&(E==="*"||(E==null?void 0:E.toLocaleLowerCase())===((_=t.data)===null||_===void 0?void 0:_.type.toLocaleLowerCase()))}else{const b=(w=(T=m==null?void 0:m.filter)===null||T===void 0?void 0:T.event)===null||w===void 0?void 0:w.toLocaleLowerCase();return b==="*"||b===((S=t==null?void 0:t.event)===null||S===void 0?void 0:S.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===a}).map(m=>{if(typeof f=="object"&&"ids"in f){const p=f.data,{schema:g,table:_,commit_timestamp:T,type:w,errors:S}=p;f=Object.assign(Object.assign({},{schema:g,table:_,commit_timestamp:T,eventType:w,new:{},old:{},errors:S}),this._getPayloadRecords(p))}m.callback(f,r)})}_isClosed(){return this.state===be.closed}_isJoined(){return this.state===be.joined}_isJoining(){return this.state===be.joining}_isLeaving(){return this.state===be.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&mn.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Oe.close,{},e)}_onError(e){this._on(Oe.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=be.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Zs(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Zs(e.columns,e.old_record)),t}}const Mc=()=>{},Nc=typeof WebSocket<"u",Lc=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Fc{constructor(e,t){var r;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=Oc,this.params={},this.timeout=Xs,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Mc,this.conn=null,this.sendBuffer=[],this.serializer=new Ac,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=i=>{let a;return i?a=i:typeof fetch>"u"?a=(...o)=>Promise.resolve().then(()=>ht).then(({default:c})=>c(...o)):a=fetch,(...o)=>a(...o)},this.endPoint=`${e}/${hn.websocket}`,this.httpEndpoint=ti(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;if(s&&(this.accessToken=s,this.apiKey=s),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,a)=>a(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Qs(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(Nc){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new Uc(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),Promise.resolve().then(()=>Zd).then(({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case ft.connecting:return Qe.Connecting;case ft.open:return Qe.Open;case ft.closing:return Qe.Closing;default:return Qe.Closed}}isConnected(){return this.connectionState()===Qe.Open}channel(e,t={config:{}}){const r=new mn(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:s,ref:i}=e,a=()=>{this.encode(e,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${t} ${r} (${i})`,s),this.isConnected()?a():this.sendBuffer.push(a)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(Oe.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Pc}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:s,payload:i,ref:a}=t;(a&&a===this.pendingHeartbeatRef||s===(i==null?void 0:i.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${s} ${a&&"("+a+")"||""}`,i),this.channels.filter(o=>o._isMember(r)).forEach(o=>o._trigger(s,i,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this._sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Oe.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(Cc,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([Lc],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class Uc{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=ft.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class gn extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function re(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Bc extends gn{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class pn extends gn{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Wc=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((r=r.apply(n,e||[])).next())})};const ai=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(()=>ht).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},qc=()=>Wc(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Promise.resolve().then(()=>ht)).Response:Response}),_n=n=>{if(Array.isArray(n))return n.map(t=>_n(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const s=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=_n(r)}),e};var Ze=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((r=r.apply(n,e||[])).next())})};const yn=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Hc=(n,e,t)=>Ze(void 0,void 0,void 0,function*(){const r=yield qc();n instanceof r&&!(t!=null&&t.noResolveJson)?n.json().then(s=>{e(new Bc(yn(s),n.status||500))}).catch(s=>{e(new pn(yn(s),s))}):e(new pn(yn(n),n))}),Jc=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r&&(s.body=JSON.stringify(r)),Object.assign(Object.assign({},s),t))};function Wt(n,e,t,r,s,i){return Ze(this,void 0,void 0,function*(){return new Promise((a,o)=>{n(t,Jc(e,r,s,i)).then(c=>{if(!c.ok)throw c;return r!=null&&r.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>Hc(c,o,r))})})}function Sr(n,e,t,r){return Ze(this,void 0,void 0,function*(){return Wt(n,"GET",e,t,r)})}function qe(n,e,t,r,s){return Ze(this,void 0,void 0,function*(){return Wt(n,"POST",e,r,s,t)})}function Vc(n,e,t,r,s){return Ze(this,void 0,void 0,function*(){return Wt(n,"PUT",e,r,s,t)})}function zc(n,e,t,r){return Ze(this,void 0,void 0,function*(){return Wt(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function oi(n,e,t,r,s){return Ze(this,void 0,void 0,function*(){return Wt(n,"DELETE",e,r,s,t)})}var me=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((r=r.apply(n,e||[])).next())})};const Yc={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ci={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Gc{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=ai(s)}uploadOrUpdate(e,t,r,s){return me(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},ci),s);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const c=a.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=r,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,c&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),s!=null&&s.headers&&(o=Object.assign(Object.assign({},o),s.headers));const l=this._removeEmptyFolders(t),u=this._getFinalPath(l),h=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:i,headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{})),f=yield h.json();return h.ok?{data:{path:l,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(i){if(re(i))return{data:null,error:i};throw i}})}upload(e,t,r){return me(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return me(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let c;const l=Object.assign({upsert:ci.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",l.cacheControl)):(c=r,u["cache-control"]=`max-age=${l.cacheControl}`,u["content-type"]=l.contentType);const h=yield this.fetch(o.toString(),{method:"PUT",body:c,headers:u}),f=yield h.json();return h.ok?{data:{path:i,fullPath:f.Key},error:null}:{data:null,error:f}}catch(c){if(re(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return me(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);t!=null&&t.upsert&&(s["x-upsert"]="true");const i=yield qe(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),a=new URL(this.url+i.url),o=a.searchParams.get("token");if(!o)throw new gn("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(r){if(re(r))return{data:null,error:r};throw r}})}update(e,t,r){return me(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return me(this,void 0,void 0,function*(){try{return{data:yield qe(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(re(s))return{data:null,error:s};throw s}})}copy(e,t,r){return me(this,void 0,void 0,function*(){try{return{data:{path:(yield qe(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(re(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return me(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield qe(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const a=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(s){if(re(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return me(this,void 0,void 0,function*(){try{const s=yield qe(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(s){if(re(s))return{data:null,error:s};throw s}})}download(e,t){return me(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=i?`?${i}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield Sr(this.fetch,`${this.url}/${s}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(re(o))return{data:null,error:o};throw o}})}info(e){return me(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Sr(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:_n(r),error:null}}catch(r){if(re(r))return{data:null,error:r};throw r}})}exists(e){return me(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield zc(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(re(r)&&r instanceof pn){const s=r.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&s.push(c);let l=s.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${r}${l}`)}}}remove(e){return me(this,void 0,void 0,function*(){try{return{data:yield oi(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(re(t))return{data:null,error:t};throw t}})}list(e,t,r){return me(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Yc),t),{prefix:e||""});return{data:yield qe(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(re(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Kc={"X-Client-Info":"storage-js/2.7.1"};var mt=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((r=r.apply(n,e||[])).next())})};class Xc{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},Kc),t),this.fetch=ai(r)}listBuckets(){return mt(this,void 0,void 0,function*(){try{return{data:yield Sr(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(re(e))return{data:null,error:e};throw e}})}getBucket(e){return mt(this,void 0,void 0,function*(){try{return{data:yield Sr(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(re(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return mt(this,void 0,void 0,function*(){try{return{data:yield qe(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(re(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return mt(this,void 0,void 0,function*(){try{return{data:yield Vc(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(re(r))return{data:null,error:r};throw r}})}emptyBucket(e){return mt(this,void 0,void 0,function*(){try{return{data:yield qe(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(re(t))return{data:null,error:t};throw t}})}deleteBucket(e){return mt(this,void 0,void 0,function*(){try{return{data:yield oi(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(re(t))return{data:null,error:t};throw t}})}}class Qc extends Xc{constructor(e,t={},r){super(e,t,r)}from(e){return new Gc(this.url,this.headers,e,this.fetch)}}const Zc="2.46.1";let qt="";typeof Deno<"u"?qt="deno":typeof document<"u"?qt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?qt="react-native":qt="node";const el={headers:{"X-Client-Info":`supabase-js-${qt}/${Zc}`}},tl={schema:"public"},rl={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},nl={};var sl=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((r=r.apply(n,e||[])).next())})};const il=n=>{let e;return n?e=n:typeof fetch>"u"?e=Bs:e=fetch,(...t)=>e(...t)},al=()=>typeof Headers>"u"?Ws:Headers,ol=(n,e,t)=>{const r=il(t),s=al();return(i,a)=>sl(void 0,void 0,void 0,function*(){var o;const c=(o=yield e())!==null&&o!==void 0?o:n;let l=new s(a==null?void 0:a.headers);return l.has("apikey")||l.set("apikey",n),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},a),{headers:l}))})};var cl=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((r=r.apply(n,e||[])).next())})};function ll(n){return n.replace(/\/$/,"")}function ul(n,e){const{db:t,auth:r,realtime:s,global:i}=n,{db:a,auth:o,realtime:c,global:l}=e,u={db:Object.assign(Object.assign({},a),t),auth:Object.assign(Object.assign({},o),r),realtime:Object.assign(Object.assign({},c),s),global:Object.assign(Object.assign({},l),i),accessToken:()=>cl(this,void 0,void 0,function*(){return""})};return n.accessToken?u.accessToken=n.accessToken:delete u.accessToken,u}const li="2.65.1",hl="http://localhost:9999",dl="supabase.auth.token",fl={"X-Client-Info":`gotrue-js/${li}`},ui=10,wn="X-Supabase-Api-Version",hi={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function ml(n){return Math.round(Date.now()/1e3)+n}function gl(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const Pe=()=>typeof document<"u",et={tested:!1,writable:!1},Ht=()=>{if(!Pe())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(et.tested)return et.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),et.tested=!0,et.writable=!0}catch{et.tested=!0,et.writable=!1}return et.writable};function bn(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}const di=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(()=>ht).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},pl=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",fi=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Er=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},xr=async(n,e)=>{await n.removeItem(e)};function _l(n){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,s,i,a,o,c,l,u=0;for(n=n.replace("-","+").replace("_","/");u<n.length;)a=e.indexOf(n.charAt(u++)),o=e.indexOf(n.charAt(u++)),c=e.indexOf(n.charAt(u++)),l=e.indexOf(n.charAt(u++)),r=a<<2|o>>4,s=(o&15)<<4|c>>2,i=(c&3)<<6|l,t=t+String.fromCharCode(r),c!=64&&s!=0&&(t=t+String.fromCharCode(s)),l!=64&&i!=0&&(t=t+String.fromCharCode(i));return t}class kr{constructor(){this.promise=new kr.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}kr.promiseConstructor=Promise;function mi(n){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=n.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(_l(r))}async function yl(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function wl(n,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await n(i);if(!e(i,null,a)){r(a);return}}catch(a){if(!e(i,a)){s(a);return}}})()})}function bl(n){return("0"+n.toString(16)).substr(-2)}function vl(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,bl).join("")}async function Sl(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}function El(n){return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function xl(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await Sl(n);return El(t)}async function gt(n,e,t=!1){const r=vl();let s=r;t&&(s+="/PASSWORD_RECOVERY"),await fi(n,`${e}-code-verifier`,s);const i=await xl(r);return[i,r===i?"plain":"s256"]}const kl=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Ol(n){const e=n.headers.get(wn);if(!e||!e.match(kl))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class vn extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function $(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class Pl extends vn{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Cl(n){return $(n)&&n.name==="AuthApiError"}class gi extends vn{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class tt extends vn{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class He extends tt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Al(n){return $(n)&&n.name==="AuthSessionMissingError"}class Sn extends tt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Or extends tt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Pr extends tt{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class pi extends tt{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class En extends tt{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function xn(n){return $(n)&&n.name==="AuthRetryableFetchError"}class _i extends tt{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}var Tl=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const rt=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Rl=[502,503,504];async function yi(n){var e;if(!pl(n))throw new En(rt(n),0);if(Rl.includes(n.status))throw new En(rt(n),n.status);let t;try{t=await n.json()}catch(i){throw new gi(rt(i),i)}let r;const s=Ol(n);if(s&&s.getTime()>=hi["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new _i(rt(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new He}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new _i(rt(t),n.status,t.weak_password.reasons);throw new Pl(rt(t),n.status||500,r)}const Il=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function L(n,e,t,r){var s;const i=Object.assign({},r==null?void 0:r.headers);i[wn]||(i[wn]=hi["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const a=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(a.redirect_to=r.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=await jl(n,e,t+o,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}}async function jl(n,e,t,r,s,i){const a=Il(e,r,s,i);let o;try{o=await n(t,Object.assign({},a))}catch(c){throw console.error(c),new En(rt(c),0)}if(o.ok||await yi(o),r!=null&&r.noResolveJson)return o;try{return await o.json()}catch(c){await yi(c)}}function Je(n){var e;let t=null;Nl(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=ml(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function wi(n){const e=Je(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function Ve(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function $l(n){return{data:n,error:null}}function Dl(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i}=n,a=Tl(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i},c=Object.assign({},a);return{data:{properties:o,user:c},error:null}}function Ml(n){return n}function Nl(n){return n.access_token&&n.refresh_token&&n.expires_in}var Ll=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class Fl{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=di(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await L(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if($(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await L(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ve})}catch(r){if($(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=Ll(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await L(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Dl,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if($(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await L(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ve})}catch(t){if($(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,i,a,o,c;try{const l={nextPage:null,lastPage:0,total:0},u=await L(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:Ml});if(u.error)throw u.error;const h=await u.json(),f=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,m=(c=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return m.length>0&&(m.forEach(p=>{const g=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(p.split(";")[1].split("=")[1]);l[`${_}Page`]=g}),l.total=parseInt(f)),{data:Object.assign(Object.assign({},h),l),error:null}}catch(l){if($(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await L(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ve})}catch(t){if($(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await L(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ve})}catch(r){if($(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await L(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ve})}catch(r){if($(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await L(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if($(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await L(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if($(t))return{data:null,error:t};throw t}}}const Ul={getItem:n=>Ht()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{Ht()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{Ht()&&globalThis.localStorage.removeItem(n)}};function bi(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function Bl(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const pt={debug:!!(globalThis&&Ht()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class vi extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Wl extends vi{}async function ql(n,e,t){pt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),pt.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){pt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,s.name);try{return await t()}finally{pt.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,s.name)}}else{if(e===0)throw pt.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new Wl(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(pt.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}})}Bl();const Hl={url:hl,storageKey:dl,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:fl,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},Jt=30*1e3,Si=3;async function Ei(n,e,t){return await t()}class Vt{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Vt.nextInstanceID,Vt.nextInstanceID+=1,this.instanceID>0&&Pe()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Hl),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Fl({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=di(s.fetch),this.lock=s.lock||Ei,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:Pe()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=ql:this.lock=Ei,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:Ht()?this.storage=Ul:(this.memoryStorage={},this.storage=bi(this.memoryStorage)):(this.memoryStorage={},this.storage=bi(this.memoryStorage)),Pe()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${li}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const e=Pe()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=await this._getSessionFromURL(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),(r==null?void 0:r.code)==="identity_already_exists"?{error:r}:(await this._removeSession(),{error:r});const{session:s,redirectType:i}=t;return this._debug("#_initialize()","detected session in URL",s,"redirect type",i),await this._saveSession(s),setTimeout(async()=>{i==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return $(e)?{error:e}:{error:new gi("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const i=await L(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:Je}),{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if($(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,r,s;try{let i;if("email"in e){const{email:u,password:h,options:f}=e;let m=null,p=null;this.flowType==="pkce"&&([m,p]=await gt(this.storage,this.storageKey)),i=await L(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:u,password:h,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:m,code_challenge_method:p},xform:Je})}else if("phone"in e){const{phone:u,password:h,options:f}=e;i=await L(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(r=f==null?void 0:f.data)!==null&&r!==void 0?r:{},channel:(s=f==null?void 0:f.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:Je})}else throw new Or("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if($(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:a,options:o}=e;t=await L(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:wi})}else if("phone"in e){const{phone:i,password:a,options:o}=e;t=await L(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:wi})}else throw new Or("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Sn}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(t){if($(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Er(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(t??"").split("/");try{const{data:i,error:a}=await L(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Je});if(await xr(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Sn}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:a})}catch(i){if($(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:i,nonce:a}=e,o=await L(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Je}),{data:c,error:l}=o;return l?{data:{user:null,session:null},error:l}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Sn}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:l})}catch(t){if($(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,i,a;try{if("email"in e){const{email:o,options:c}=e;let l=null,u=null;this.flowType==="pkce"&&([l,u]=await gt(this.storage,this.storageKey));const{error:h}=await L(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:l,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:o,options:c}=e,{data:l,error:u}=await L(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(a=c==null?void 0:c.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:u}}throw new Or("You must provide either an email or phone number.")}catch(o){if($(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,r;try{let s,i;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:a,error:o}=await L(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:Je});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const c=a.session,l=a.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(s){if($(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let i=null,a=null;return this.flowType==="pkce"&&([i,a]=await gt(this.storage,this.storageKey)),await L(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:$l})}catch(i){if($(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new He;const{error:s}=await L(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if($(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:a}=await L(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:a,error:o}=await L(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new Or("You must provide either an email or phone number and a type")}catch(t){if($(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Er(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,l,u)=>(!a&&l==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,l,u))})}return{data:{session:e},error:null}}const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await L(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ve}):await this._useSession(async t=>{var r,s,i;const{data:a,error:o}=t;if(o)throw o;return!(!((r=a.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new He}:await L(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:Ve})})}catch(t){if($(t))return Al(t)&&(await this._removeSession(),await xr(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new He;const a=s.session;let o=null,c=null;this.flowType==="pkce"&&e.email!=null&&([o,c]=await gt(this.storage,this.storageKey));const{data:l,error:u}=await L(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:c}),jwt:a.access_token,xform:Ve});if(u)throw u;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(r){if($(r))return{data:{user:null},error:r};throw r}}_decodeJWT(e){return mi(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new He;const t=Date.now()/1e3;let r=t,s=!0,i=null;const a=mi(e.access_token);if(a.exp&&(r=a.exp,s=r<=t),s){const{session:o,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if($(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(r=a.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new He;const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if($(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e){try{if(!Pe())throw new Pr("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new Pr("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new pi("Not a valid PKCE flow url.");const t=bn(window.location.href);if(e){if(!t.code)throw new pi("No code detected.");const{data:w,error:S}=await this._exchangeCodeForSession(t.code);if(S)throw S;const b=new URL(window.location.href);return b.searchParams.delete("code"),window.history.replaceState(window.history.state,"",b.toString()),{data:{session:w.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new Pr(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:a,expires_in:o,expires_at:c,token_type:l}=t;if(!i||!o||!a||!l)throw new Pr("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(o);let f=u+h;c&&(f=parseInt(c));const m=f-u;m*1e3<=Jt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${h}s`);const p=f-h;u-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,f,u):u-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,f,u);const{data:g,error:_}=await this._getUser(i);if(_)throw _;const T={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:h,expires_at:f,refresh_token:a,token_type:l,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:T,redirectType:t.type},error:null}}catch(t){if($(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){const e=bn(window.location.href);return!!(Pe()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=bn(window.location.href),t=await Er(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{error:i};const a=(r=s.session)===null||r===void 0?void 0:r.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(Cl(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await xr(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=gl(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:i},error:a}=t;if(a)throw a;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await gt(this.storage,this.storageKey,!0));try{return await L(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if($(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if($(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async i=>{var a,o,c,l,u;const{data:h,error:f}=i;if(f)throw f;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await L(this.fetch,"GET",m,{headers:this.headers,jwt:(u=(l=h.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return Pe()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if($(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:a}=t;if(a)throw a;return await L(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if($(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await wl(async s=>(s>0&&await yl(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await L(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Je})),(s,i)=>{const a=200*Math.pow(2,s);return i&&xn(i)&&Date.now()+a-r<Jt})}catch(r){if(this._debug(t,"error",r),$(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),Pe()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Er(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const s=Math.round(Date.now()/1e3),i=((e=r.expires_at)!==null&&e!==void 0?e:1/0)<s+ui;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${ui}s`),i){if(this.autoRefreshToken&&r.refresh_token){const{error:a}=await this._callRefreshToken(r.refresh_token);a&&(console.error(a),xn(a)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new He;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new kr;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new He;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(s,"error",i),$(i)){const a={session:null,error:i};return xn(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await fi(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await xr(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Pe()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Jt);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/Jt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Jt}ms, refresh threshold is ${Si} ticks`),s<=Si&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof vi)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Pe()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,a]=await gt(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});s.push(o.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);s.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await L(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if($(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:l}=await L(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(e.factorType==="totp"&&(!((s=c==null?void 0:c.totp)===null||s===void 0)&&s.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if($(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{data:null,error:i};const{data:a,error:o}=await L(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if($(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await L(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if($(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],s=r.filter(a=>a.factor_type==="totp"&&a.status==="verified"),i=r.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:r,totp:s,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const a=this._decodeJWT(s.access_token);let o=null;a.aal&&(o=a.aal);let c=o;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(c="aal2");const u=a.amr||[];return{data:{currentLevel:o,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}}Vt.nextInstanceID=0;const Jl=Vt;class Vl extends Jl{constructor(e){super(e)}}var zl=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((r=r.apply(n,e||[])).next())})};class Yl{constructor(e,t,r){var s,i,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=ll(e);this.realtimeUrl=`${o}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${o}/auth/v1`,this.storageUrl=`${o}/storage/v1`,this.functionsUrl=`${o}/functions/v1`;const c=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l={db:tl,realtime:nl,auth:Object.assign(Object.assign({},rl),{storageKey:c}),global:el},u=ul(r??{},l);this.storageKey=(s=u.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(h,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=u.auth)!==null&&a!==void 0?a:{},this.headers,u.global.fetch),this.fetch=ol(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},u.realtime)),this.rest=new kc(`${o}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new tc(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Qc(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return zl(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:i,flowType:a,lock:o,debug:c},l,u){var h;const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Vl({url:this.authUrl,headers:Object.assign(Object.assign({},f),l),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:a,lock:o,debug:c,fetch:u,hasCustomAuthorizationHeader:(h="Authorization"in this.headers)!==null&&h!==void 0?h:!1})}_initRealtimeClient(e){return new Fc(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.realtime.setAuth(r??null),this.changedAccessToken=r):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Q=((n,e,t)=>new Yl(n,e,t))("https://zozodfjzxzlwzkhmfhwh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpvem9kZmp6eHpsd3praG1maHdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIwNDM3MjMsImV4cCI6MjA0NzYxOTcyM30.ywmi4WD1fZN3hRu-krtGmY1-IYSJSODh1tKK4Ytt18Q");function Ce(n){const e=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&e==="[object Date]"?new n.constructor(+n):typeof n=="number"||e==="[object Number]"||typeof n=="string"||e==="[object String]"?new Date(n):new Date(NaN)}function nt(n,e){return n instanceof Date?new n.constructor(e):new Date(e)}const xi=6048e5,Gl=864e5;let Kl={};function Cr(){return Kl}function zt(n,e){var o,c,l,u;const t=Cr(),r=(e==null?void 0:e.weekStartsOn)??((c=(o=e==null?void 0:e.locale)==null?void 0:o.options)==null?void 0:c.weekStartsOn)??t.weekStartsOn??((u=(l=t.locale)==null?void 0:l.options)==null?void 0:u.weekStartsOn)??0,s=Ce(n),i=s.getDay(),a=(i<r?7:0)+i-r;return s.setDate(s.getDate()-a),s.setHours(0,0,0,0),s}function Ar(n){return zt(n,{weekStartsOn:1})}function ki(n){const e=Ce(n),t=e.getFullYear(),r=nt(n,0);r.setFullYear(t+1,0,4),r.setHours(0,0,0,0);const s=Ar(r),i=nt(n,0);i.setFullYear(t,0,4),i.setHours(0,0,0,0);const a=Ar(i);return e.getTime()>=s.getTime()?t+1:e.getTime()>=a.getTime()?t:t-1}function Oi(n){const e=Ce(n);return e.setHours(0,0,0,0),e}function Pi(n){const e=Ce(n),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+n-+t}function Xl(n,e){const t=Oi(n),r=Oi(e),s=+t-Pi(t),i=+r-Pi(r);return Math.round((s-i)/Gl)}function Ql(n){const e=ki(n),t=nt(n,0);return t.setFullYear(e,0,4),t.setHours(0,0,0,0),Ar(t)}function Zl(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function eu(n){if(!Zl(n)&&typeof n!="number")return!1;const e=Ce(n);return!isNaN(Number(e))}function tu(n){const e=Ce(n),t=nt(n,0);return t.setFullYear(e.getFullYear(),0,1),t.setHours(0,0,0,0),t}const ru={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},nu=(n,e,t)=>{let r;const s=ru[n];return typeof s=="string"?r=s:e===1?r=s.one:r=s.other.replace("{{count}}",e.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+r:r+" ago":r};function kn(n){return(e={})=>{const t=e.width?String(e.width):n.defaultWidth;return n.formats[t]||n.formats[n.defaultWidth]}}const su={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},iu={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},au={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},ou={date:kn({formats:su,defaultWidth:"full"}),time:kn({formats:iu,defaultWidth:"full"}),dateTime:kn({formats:au,defaultWidth:"full"})},cu={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},lu=(n,e,t,r)=>cu[n];function Yt(n){return(e,t)=>{const r=t!=null&&t.context?String(t.context):"standalone";let s;if(r==="formatting"&&n.formattingValues){const a=n.defaultFormattingWidth||n.defaultWidth,o=t!=null&&t.width?String(t.width):a;s=n.formattingValues[o]||n.formattingValues[a]}else{const a=n.defaultWidth,o=t!=null&&t.width?String(t.width):n.defaultWidth;s=n.values[o]||n.values[a]}const i=n.argumentCallback?n.argumentCallback(e):e;return s[i]}}const uu={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},hu={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},du={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},fu={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},mu={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},gu={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},pu={ordinalNumber:(n,e)=>{const t=Number(n),r=t%100;if(r>20||r<10)switch(r%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},era:Yt({values:uu,defaultWidth:"wide"}),quarter:Yt({values:hu,defaultWidth:"wide",argumentCallback:n=>n-1}),month:Yt({values:du,defaultWidth:"wide"}),day:Yt({values:fu,defaultWidth:"wide"}),dayPeriod:Yt({values:mu,defaultWidth:"wide",formattingValues:gu,defaultFormattingWidth:"wide"})};function Gt(n){return(e,t={})=>{const r=t.width,s=r&&n.matchPatterns[r]||n.matchPatterns[n.defaultMatchWidth],i=e.match(s);if(!i)return null;const a=i[0],o=r&&n.parsePatterns[r]||n.parsePatterns[n.defaultParseWidth],c=Array.isArray(o)?yu(o,h=>h.test(a)):_u(o,h=>h.test(a));let l;l=n.valueCallback?n.valueCallback(c):c,l=t.valueCallback?t.valueCallback(l):l;const u=e.slice(a.length);return{value:l,rest:u}}}function _u(n,e){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&e(n[t]))return t}function yu(n,e){for(let t=0;t<n.length;t++)if(e(n[t]))return t}function wu(n){return(e,t={})=>{const r=e.match(n.matchPattern);if(!r)return null;const s=r[0],i=e.match(n.parsePattern);if(!i)return null;let a=n.valueCallback?n.valueCallback(i[0]):i[0];a=t.valueCallback?t.valueCallback(a):a;const o=e.slice(s.length);return{value:a,rest:o}}}const bu=/^(\d+)(th|st|nd|rd)?/i,vu=/\d+/i,Su={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Eu={any:[/^b/i,/^(a|c)/i]},xu={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},ku={any:[/1/i,/2/i,/3/i,/4/i]},Ou={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Pu={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Cu={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Au={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Tu={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Ru={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Iu={ordinalNumber:wu({matchPattern:bu,parsePattern:vu,valueCallback:n=>parseInt(n,10)}),era:Gt({matchPatterns:Su,defaultMatchWidth:"wide",parsePatterns:Eu,defaultParseWidth:"any"}),quarter:Gt({matchPatterns:xu,defaultMatchWidth:"wide",parsePatterns:ku,defaultParseWidth:"any",valueCallback:n=>n+1}),month:Gt({matchPatterns:Ou,defaultMatchWidth:"wide",parsePatterns:Pu,defaultParseWidth:"any"}),day:Gt({matchPatterns:Cu,defaultMatchWidth:"wide",parsePatterns:Au,defaultParseWidth:"any"}),dayPeriod:Gt({matchPatterns:Tu,defaultMatchWidth:"any",parsePatterns:Ru,defaultParseWidth:"any"})},ju={code:"en-US",formatDistance:nu,formatLong:ou,formatRelative:lu,localize:pu,match:Iu,options:{weekStartsOn:0,firstWeekContainsDate:1}};function $u(n){const e=Ce(n);return Xl(e,tu(e))+1}function Du(n){const e=Ce(n),t=+Ar(e)-+Ql(e);return Math.round(t/xi)+1}function Ci(n,e){var u,h,f,m;const t=Ce(n),r=t.getFullYear(),s=Cr(),i=(e==null?void 0:e.firstWeekContainsDate)??((h=(u=e==null?void 0:e.locale)==null?void 0:u.options)==null?void 0:h.firstWeekContainsDate)??s.firstWeekContainsDate??((m=(f=s.locale)==null?void 0:f.options)==null?void 0:m.firstWeekContainsDate)??1,a=nt(n,0);a.setFullYear(r+1,0,i),a.setHours(0,0,0,0);const o=zt(a,e),c=nt(n,0);c.setFullYear(r,0,i),c.setHours(0,0,0,0);const l=zt(c,e);return t.getTime()>=o.getTime()?r+1:t.getTime()>=l.getTime()?r:r-1}function Mu(n,e){var o,c,l,u;const t=Cr(),r=(e==null?void 0:e.firstWeekContainsDate)??((c=(o=e==null?void 0:e.locale)==null?void 0:o.options)==null?void 0:c.firstWeekContainsDate)??t.firstWeekContainsDate??((u=(l=t.locale)==null?void 0:l.options)==null?void 0:u.firstWeekContainsDate)??1,s=Ci(n,e),i=nt(n,0);return i.setFullYear(s,0,r),i.setHours(0,0,0,0),zt(i,e)}function Nu(n,e){const t=Ce(n),r=+zt(t,e)-+Mu(t,e);return Math.round(r/xi)+1}function H(n,e){const t=n<0?"-":"",r=Math.abs(n).toString().padStart(e,"0");return t+r}const ze={y(n,e){const t=n.getFullYear(),r=t>0?t:1-t;return H(e==="yy"?r%100:r,e.length)},M(n,e){const t=n.getMonth();return e==="M"?String(t+1):H(t+1,2)},d(n,e){return H(n.getDate(),e.length)},a(n,e){const t=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(n,e){return H(n.getHours()%12||12,e.length)},H(n,e){return H(n.getHours(),e.length)},m(n,e){return H(n.getMinutes(),e.length)},s(n,e){return H(n.getSeconds(),e.length)},S(n,e){const t=e.length,r=n.getMilliseconds(),s=Math.trunc(r*Math.pow(10,t-3));return H(s,e.length)}},_t={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Ai={G:function(n,e,t){const r=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(r,{width:"abbreviated"});case"GGGGG":return t.era(r,{width:"narrow"});case"GGGG":default:return t.era(r,{width:"wide"})}},y:function(n,e,t){if(e==="yo"){const r=n.getFullYear(),s=r>0?r:1-r;return t.ordinalNumber(s,{unit:"year"})}return ze.y(n,e)},Y:function(n,e,t,r){const s=Ci(n,r),i=s>0?s:1-s;if(e==="YY"){const a=i%100;return H(a,2)}return e==="Yo"?t.ordinalNumber(i,{unit:"year"}):H(i,e.length)},R:function(n,e){const t=ki(n);return H(t,e.length)},u:function(n,e){const t=n.getFullYear();return H(t,e.length)},Q:function(n,e,t){const r=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return H(r,2);case"Qo":return t.ordinalNumber(r,{unit:"quarter"});case"QQQ":return t.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(r,{width:"wide",context:"formatting"})}},q:function(n,e,t){const r=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return H(r,2);case"qo":return t.ordinalNumber(r,{unit:"quarter"});case"qqq":return t.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(r,{width:"wide",context:"standalone"})}},M:function(n,e,t){const r=n.getMonth();switch(e){case"M":case"MM":return ze.M(n,e);case"Mo":return t.ordinalNumber(r+1,{unit:"month"});case"MMM":return t.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(r,{width:"wide",context:"formatting"})}},L:function(n,e,t){const r=n.getMonth();switch(e){case"L":return String(r+1);case"LL":return H(r+1,2);case"Lo":return t.ordinalNumber(r+1,{unit:"month"});case"LLL":return t.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(r,{width:"wide",context:"standalone"})}},w:function(n,e,t,r){const s=Nu(n,r);return e==="wo"?t.ordinalNumber(s,{unit:"week"}):H(s,e.length)},I:function(n,e,t){const r=Du(n);return e==="Io"?t.ordinalNumber(r,{unit:"week"}):H(r,e.length)},d:function(n,e,t){return e==="do"?t.ordinalNumber(n.getDate(),{unit:"date"}):ze.d(n,e)},D:function(n,e,t){const r=$u(n);return e==="Do"?t.ordinalNumber(r,{unit:"dayOfYear"}):H(r,e.length)},E:function(n,e,t){const r=n.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(r,{width:"short",context:"formatting"});case"EEEE":default:return t.day(r,{width:"wide",context:"formatting"})}},e:function(n,e,t,r){const s=n.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return H(i,2);case"eo":return t.ordinalNumber(i,{unit:"day"});case"eee":return t.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(s,{width:"short",context:"formatting"});case"eeee":default:return t.day(s,{width:"wide",context:"formatting"})}},c:function(n,e,t,r){const s=n.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return H(i,e.length);case"co":return t.ordinalNumber(i,{unit:"day"});case"ccc":return t.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(s,{width:"narrow",context:"standalone"});case"cccccc":return t.day(s,{width:"short",context:"standalone"});case"cccc":default:return t.day(s,{width:"wide",context:"standalone"})}},i:function(n,e,t){const r=n.getDay(),s=r===0?7:r;switch(e){case"i":return String(s);case"ii":return H(s,e.length);case"io":return t.ordinalNumber(s,{unit:"day"});case"iii":return t.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(r,{width:"short",context:"formatting"});case"iiii":default:return t.day(r,{width:"wide",context:"formatting"})}},a:function(n,e,t){const s=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(n,e,t){const r=n.getHours();let s;switch(r===12?s=_t.noon:r===0?s=_t.midnight:s=r/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(n,e,t){const r=n.getHours();let s;switch(r>=17?s=_t.evening:r>=12?s=_t.afternoon:r>=4?s=_t.morning:s=_t.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(n,e,t){if(e==="ho"){let r=n.getHours()%12;return r===0&&(r=12),t.ordinalNumber(r,{unit:"hour"})}return ze.h(n,e)},H:function(n,e,t){return e==="Ho"?t.ordinalNumber(n.getHours(),{unit:"hour"}):ze.H(n,e)},K:function(n,e,t){const r=n.getHours()%12;return e==="Ko"?t.ordinalNumber(r,{unit:"hour"}):H(r,e.length)},k:function(n,e,t){let r=n.getHours();return r===0&&(r=24),e==="ko"?t.ordinalNumber(r,{unit:"hour"}):H(r,e.length)},m:function(n,e,t){return e==="mo"?t.ordinalNumber(n.getMinutes(),{unit:"minute"}):ze.m(n,e)},s:function(n,e,t){return e==="so"?t.ordinalNumber(n.getSeconds(),{unit:"second"}):ze.s(n,e)},S:function(n,e){return ze.S(n,e)},X:function(n,e,t){const r=n.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return Ri(r);case"XXXX":case"XX":return st(r);case"XXXXX":case"XXX":default:return st(r,":")}},x:function(n,e,t){const r=n.getTimezoneOffset();switch(e){case"x":return Ri(r);case"xxxx":case"xx":return st(r);case"xxxxx":case"xxx":default:return st(r,":")}},O:function(n,e,t){const r=n.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+Ti(r,":");case"OOOO":default:return"GMT"+st(r,":")}},z:function(n,e,t){const r=n.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+Ti(r,":");case"zzzz":default:return"GMT"+st(r,":")}},t:function(n,e,t){const r=Math.trunc(n.getTime()/1e3);return H(r,e.length)},T:function(n,e,t){const r=n.getTime();return H(r,e.length)}};function Ti(n,e=""){const t=n>0?"-":"+",r=Math.abs(n),s=Math.trunc(r/60),i=r%60;return i===0?t+String(s):t+String(s)+e+H(i,2)}function Ri(n,e){return n%60===0?(n>0?"-":"+")+H(Math.abs(n)/60,2):st(n,e)}function st(n,e=""){const t=n>0?"-":"+",r=Math.abs(n),s=H(Math.trunc(r/60),2),i=H(r%60,2);return t+s+e+i}const Ii=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},ji=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},Lu={p:ji,P:(n,e)=>{const t=n.match(/(P+)(p+)?/)||[],r=t[1],s=t[2];if(!s)return Ii(n,e);let i;switch(r){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",Ii(r,e)).replace("{{time}}",ji(s,e))}},Fu=/^D+$/,Uu=/^Y+$/,Bu=["D","DD","YY","YYYY"];function Wu(n){return Fu.test(n)}function qu(n){return Uu.test(n)}function Hu(n,e,t){const r=Ju(n,e,t);if(console.warn(r),Bu.includes(n))throw new RangeError(r)}function Ju(n,e,t){const r=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${r} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Vu=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,zu=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Yu=/^'([^]*?)'?$/,Gu=/''/g,Ku=/[a-zA-Z]/;function Tr(n,e,t){var u,h,f,m;const r=Cr(),s=r.locale??ju,i=r.firstWeekContainsDate??((h=(u=r.locale)==null?void 0:u.options)==null?void 0:h.firstWeekContainsDate)??1,a=r.weekStartsOn??((m=(f=r.locale)==null?void 0:f.options)==null?void 0:m.weekStartsOn)??0,o=Ce(n);if(!eu(o))throw new RangeError("Invalid time value");let c=e.match(zu).map(p=>{const g=p[0];if(g==="p"||g==="P"){const _=Lu[g];return _(p,s.formatLong)}return p}).join("").match(Vu).map(p=>{if(p==="''")return{isToken:!1,value:"'"};const g=p[0];if(g==="'")return{isToken:!1,value:Xu(p)};if(Ai[g])return{isToken:!0,value:p};if(g.match(Ku))throw new RangeError("Format string contains an unescaped latin alphabet character `"+g+"`");return{isToken:!1,value:p}});s.localize.preprocessor&&(c=s.localize.preprocessor(o,c));const l={firstWeekContainsDate:i,weekStartsOn:a,locale:s};return c.map(p=>{if(!p.isToken)return p.value;const g=p.value;(qu(g)||Wu(g))&&Hu(g,e,String(n));const _=Ai[g[0]];return _(o,g,s.localize,l)}).join("")}function Xu(n){const e=n.match(Yu);return e?e[1].replace(Gu,"'"):n}const Qu={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_OPENAI_API_KEY:"",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpvem9kZmp6eHpsd3praG1maHdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIwNDM3MjMsImV4cCI6MjA0NzYxOTcyM30.ywmi4WD1fZN3hRu-krtGmY1-IYSJSODh1tKK4Ytt18Q",VITE_SUPABASE_URL:"https://zozodfjzxzlwzkhmfhwh.supabase.co"},$i=n=>{let e;const t=new Set,r=(u,h)=>{const f=typeof u=="function"?u(e):u;if(!Object.is(f,e)){const m=e;e=h??(typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach(p=>p(e,m))}},s=()=>e,c={setState:r,getState:s,getInitialState:()=>l,subscribe:u=>(t.add(u),()=>t.delete(u)),destroy:()=>{(Qu?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},l=e=n(r,s,c);return c},Zu=n=>n?$i(n):$i;var On={exports:{}},Pn={},Rr={exports:{}},Cn={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Di;function eh(){if(Di)return Cn;Di=1;var n=j;function e(h,f){return h===f&&(h!==0||1/h===1/f)||h!==h&&f!==f}var t=typeof Object.is=="function"?Object.is:e,r=n.useState,s=n.useEffect,i=n.useLayoutEffect,a=n.useDebugValue;function o(h,f){var m=f(),p=r({inst:{value:m,getSnapshot:f}}),g=p[0].inst,_=p[1];return i(function(){g.value=m,g.getSnapshot=f,c(g)&&_({inst:g})},[h,m,f]),s(function(){return c(g)&&_({inst:g}),h(function(){c(g)&&_({inst:g})})},[h]),a(m),m}function c(h){var f=h.getSnapshot;h=h.value;try{var m=f();return!t(h,m)}catch{return!0}}function l(h,f){return f()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?l:o;return Cn.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:u,Cn}var An={},Mi;function th(){if(Mi)return An;Mi=1;var n={};/**
 * @license React
 * use-sync-external-store-shim.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */return n.NODE_ENV!=="production"&&function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var e=j,t=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function r(b){{for(var E=arguments.length,k=new Array(E>1?E-1:0),x=1;x<E;x++)k[x-1]=arguments[x];s("error",b,k)}}function s(b,E,k){{var x=t.ReactDebugCurrentFrame,W=x.getStackAddendum();W!==""&&(E+="%s",k=k.concat([W]));var B=k.map(function(I){return String(I)});B.unshift("Warning: "+E),Function.prototype.apply.call(console[b],console,B)}}function i(b,E){return b===E&&(b!==0||1/b===1/E)||b!==b&&E!==E}var a=typeof Object.is=="function"?Object.is:i,o=e.useState,c=e.useEffect,l=e.useLayoutEffect,u=e.useDebugValue,h=!1,f=!1;function m(b,E,k){h||e.startTransition!==void 0&&(h=!0,r("You are using an outdated, pre-release alpha of React 18 that does not support useSyncExternalStore. The use-sync-external-store shim will not work correctly. Upgrade to a newer pre-release."));var x=E();if(!f){var W=E();a(x,W)||(r("The result of getSnapshot should be cached to avoid an infinite loop"),f=!0)}var B=o({inst:{value:x,getSnapshot:E}}),I=B[0].inst,D=B[1];return l(function(){I.value=x,I.getSnapshot=E,p(I)&&D({inst:I})},[b,x,E]),c(function(){p(I)&&D({inst:I});var _e=function(){p(I)&&D({inst:I})};return b(_e)},[b]),u(x),x}function p(b){var E=b.getSnapshot,k=b.value;try{var x=E();return!a(k,x)}catch{return!0}}function g(b,E,k){return E()}var _=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",T=!_,w=T?g:m,S=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:w;An.useSyncExternalStore=S,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)}(),An}var Ni;function Li(){if(Ni)return Rr.exports;Ni=1;var n={};return n.NODE_ENV==="production"?Rr.exports=eh():Rr.exports=th(),Rr.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fi;function rh(){if(Fi)return Pn;Fi=1;var n=j,e=Li();function t(l,u){return l===u&&(l!==0||1/l===1/u)||l!==l&&u!==u}var r=typeof Object.is=="function"?Object.is:t,s=e.useSyncExternalStore,i=n.useRef,a=n.useEffect,o=n.useMemo,c=n.useDebugValue;return Pn.useSyncExternalStoreWithSelector=function(l,u,h,f,m){var p=i(null);if(p.current===null){var g={hasValue:!1,value:null};p.current=g}else g=p.current;p=o(function(){function T(k){if(!w){if(w=!0,S=k,k=f(k),m!==void 0&&g.hasValue){var x=g.value;if(m(x,k))return b=x}return b=k}if(x=b,r(S,k))return x;var W=f(k);return m!==void 0&&m(x,W)?x:(S=k,b=W)}var w=!1,S,b,E=h===void 0?null:h;return[function(){return T(u())},E===null?void 0:function(){return T(E())}]},[u,h,f,m]);var _=s(l,p[0],p[1]);return a(function(){g.hasValue=!0,g.value=_},[_]),c(_),_},Pn}var Tn={},Ui;function nh(){if(Ui)return Tn;Ui=1;var n={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */return n.NODE_ENV!=="production"&&function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var e=j,t=Li();function r(h,f){return h===f&&(h!==0||1/h===1/f)||h!==h&&f!==f}var s=typeof Object.is=="function"?Object.is:r,i=t.useSyncExternalStore,a=e.useRef,o=e.useEffect,c=e.useMemo,l=e.useDebugValue;function u(h,f,m,p,g){var _=a(null),T;_.current===null?(T={hasValue:!1,value:null},_.current=T):T=_.current;var w=c(function(){var k=!1,x,W,B=function(ue){if(!k){k=!0,x=ue;var se=p(ue);if(g!==void 0&&T.hasValue){var ce=T.value;if(g(ce,se))return W=ce,ce}return W=se,se}var We=x,Xe=W;if(s(We,ue))return Xe;var le=p(ue);return g!==void 0&&g(Xe,le)?Xe:(x=ue,W=le,le)},I=m===void 0?null:m,D=function(){return B(f())},_e=I===null?void 0:function(){return B(I())};return[D,_e]},[f,m,p,g]),S=w[0],b=w[1],E=i(h,S,b);return o(function(){T.hasValue=!0,T.value=E},[E]),l(E),E}Tn.useSyncExternalStoreWithSelector=u,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)}(),Tn}var sh={};sh.NODE_ENV==="production"?On.exports=rh():On.exports=nh();var ih=On.exports;const ah=Ns(ih),Bi={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_OPENAI_API_KEY:"",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpvem9kZmp6eHpsd3praG1maHdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIwNDM3MjMsImV4cCI6MjA0NzYxOTcyM30.ywmi4WD1fZN3hRu-krtGmY1-IYSJSODh1tKK4Ytt18Q",VITE_SUPABASE_URL:"https://zozodfjzxzlwzkhmfhwh.supabase.co"},{useDebugValue:oh}=j,{useSyncExternalStoreWithSelector:ch}=ah;let Wi=!1;const lh=n=>n;function uh(n,e=lh,t){(Bi?"production":void 0)!=="production"&&t&&!Wi&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Wi=!0);const r=ch(n.subscribe,n.getState,n.getServerState||n.getInitialState,e,t);return oh(r),r}const qi=n=>{(Bi?"production":void 0)!=="production"&&typeof n!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof n=="function"?Zu(n):n,t=(r,s)=>uh(e,r,s);return Object.assign(t,e),t},hh=n=>n?qi(n):qi;let dh={data:""},fh=n=>typeof window=="object"?((n?n.querySelector("#_goober"):window._goober)||Object.assign((n||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:n||dh,mh=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,gh=/\/\*[^]*?\*\/|  +/g,Hi=/\n+/g,Ye=(n,e)=>{let t="",r="",s="";for(let i in n){let a=n[i];i[0]=="@"?i[1]=="i"?t=i+" "+a+";":r+=i[1]=="f"?Ye(a,i):i+"{"+Ye(a,i[1]=="k"?"":e)+"}":typeof a=="object"?r+=Ye(a,e?e.replace(/([^,])+/g,o=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,c=>/&/.test(c)?c.replace(/&/g,o):o?o+" "+c:c)):i):a!=null&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),s+=Ye.p?Ye.p(i,a):i+":"+a+";")}return t+(e&&s?e+"{"+s+"}":s)+r},Le={},Ji=n=>{if(typeof n=="object"){let e="";for(let t in n)e+=t+Ji(n[t]);return e}return n},ph=(n,e,t,r,s)=>{let i=Ji(n),a=Le[i]||(Le[i]=(c=>{let l=0,u=11;for(;l<c.length;)u=101*u+c.charCodeAt(l++)>>>0;return"go"+u})(i));if(!Le[a]){let c=i!==n?n:(l=>{let u,h,f=[{}];for(;u=mh.exec(l.replace(gh,""));)u[4]?f.shift():u[3]?(h=u[3].replace(Hi," ").trim(),f.unshift(f[0][h]=f[0][h]||{})):f[0][u[1]]=u[2].replace(Hi," ").trim();return f[0]})(n);Le[a]=Ye(s?{["@keyframes "+a]:c}:c,t?"":"."+a)}let o=t&&Le.g?Le.g:null;return t&&(Le.g=Le[a]),((c,l,u,h)=>{h?l.data=l.data.replace(h,c):l.data.indexOf(c)===-1&&(l.data=u?c+l.data:l.data+c)})(Le[a],e,r,o),a},_h=(n,e,t)=>n.reduce((r,s,i)=>{let a=e[i];if(a&&a.call){let o=a(t),c=o&&o.props&&o.props.className||/^go/.test(o)&&o;a=c?"."+c:o&&typeof o=="object"?o.props?"":Ye(o,""):o===!1?"":o}return r+s+(a??"")},"");function Ir(n){let e=this||{},t=n.call?n(e.p):n;return ph(t.unshift?t.raw?_h(t,[].slice.call(arguments,1),e.p):t.reduce((r,s)=>Object.assign(r,s&&s.call?s(e.p):s),{}):t,fh(e.target),e.g,e.o,e.k)}let Vi,Rn,In;Ir.bind({g:1});let Fe=Ir.bind({k:1});function yh(n,e,t,r){Ye.p=e,Vi=n,Rn=t,In=r}function Ge(n,e){let t=this||{};return function(){let r=arguments;function s(i,a){let o=Object.assign({},i),c=o.className||s.className;t.p=Object.assign({theme:Rn&&Rn()},o),t.o=/ *go\d+/.test(c),o.className=Ir.apply(t,r)+(c?" "+c:"");let l=n;return n[0]&&(l=o.as||n,delete o.as),In&&l[0]&&In(o),Vi(l,o)}return s}}var wh=n=>typeof n=="function",jn=(n,e)=>wh(n)?n(e):n,bh=(()=>{let n=0;return()=>(++n).toString()})(),vh=(()=>{let n;return()=>{if(n===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");n=!e||e.matches}return n}})(),Sh=20,jr=new Map,Eh=1e3,zi=n=>{if(jr.has(n))return;let e=setTimeout(()=>{jr.delete(n),$r({type:4,toastId:n})},Eh);jr.set(n,e)},xh=n=>{let e=jr.get(n);e&&clearTimeout(e)},$n=(n,e)=>{switch(e.type){case 0:return{...n,toasts:[e.toast,...n.toasts].slice(0,Sh)};case 1:return e.toast.id&&xh(e.toast.id),{...n,toasts:n.toasts.map(i=>i.id===e.toast.id?{...i,...e.toast}:i)};case 2:let{toast:t}=e;return n.toasts.find(i=>i.id===t.id)?$n(n,{type:1,toast:t}):$n(n,{type:0,toast:t});case 3:let{toastId:r}=e;return r?zi(r):n.toasts.forEach(i=>{zi(i.id)}),{...n,toasts:n.toasts.map(i=>i.id===r||r===void 0?{...i,visible:!1}:i)};case 4:return e.toastId===void 0?{...n,toasts:[]}:{...n,toasts:n.toasts.filter(i=>i.id!==e.toastId)};case 5:return{...n,pausedAt:e.time};case 6:let s=e.time-(n.pausedAt||0);return{...n,pausedAt:void 0,toasts:n.toasts.map(i=>({...i,pauseDuration:i.pauseDuration+s}))}}},kh=[],Dn={toasts:[],pausedAt:void 0},$r=n=>{Dn=$n(Dn,n),kh.forEach(e=>{e(Dn)})},Oh=(n,e="blank",t)=>({createdAt:Date.now(),visible:!0,type:e,ariaProps:{role:"status","aria-live":"polite"},message:n,pauseDuration:0,...t,id:(t==null?void 0:t.id)||bh()}),Kt=n=>(e,t)=>{let r=Oh(e,n,t);return $r({type:2,toast:r}),r.id},xe=(n,e)=>Kt("blank")(n,e);xe.error=Kt("error"),xe.success=Kt("success"),xe.loading=Kt("loading"),xe.custom=Kt("custom"),xe.dismiss=n=>{$r({type:3,toastId:n})},xe.remove=n=>$r({type:4,toastId:n}),xe.promise=(n,e,t)=>{let r=xe.loading(e.loading,{...t,...t==null?void 0:t.loading});return n.then(s=>(xe.success(jn(e.success,s),{id:r,...t,...t==null?void 0:t.success}),s)).catch(s=>{xe.error(jn(e.error,s),{id:r,...t,...t==null?void 0:t.error})}),n};var Ph=Fe`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,Ch=Fe`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Ah=Fe`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Th=Ge("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${n=>n.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Ph} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${Ch} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${n=>n.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Ah} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Rh=Fe`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Ih=Ge("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${n=>n.secondary||"#e0e0e0"};
  border-right-color: ${n=>n.primary||"#616161"};
  animation: ${Rh} 1s linear infinite;
`,jh=Fe`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,$h=Fe`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Dh=Ge("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${n=>n.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${jh} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${$h} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${n=>n.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Mh=Ge("div")`
  position: absolute;
`,Nh=Ge("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Lh=Fe`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Fh=Ge("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Lh} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Uh=({toast:n})=>{let{icon:e,type:t,iconTheme:r}=n;return e!==void 0?typeof e=="string"?we.createElement(Fh,null,e):e:t==="blank"?null:we.createElement(Nh,null,we.createElement(Ih,{...r}),t!=="loading"&&we.createElement(Mh,null,t==="error"?we.createElement(Th,{...r}):we.createElement(Dh,{...r})))},Bh=n=>`
0% {transform: translate3d(0,${n*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Wh=n=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${n*-150}%,-1px) scale(.6); opacity:0;}
`,qh="0%{opacity:0;} 100%{opacity:1;}",Hh="0%{opacity:1;} 100%{opacity:0;}",Jh=Ge("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Vh=Ge("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,zh=(n,e)=>{let t=n.includes("top")?1:-1,[r,s]=vh()?[qh,Hh]:[Bh(t),Wh(t)];return{animation:e?`${Fe(r)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${Fe(s)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}};we.memo(({toast:n,position:e,style:t,children:r})=>{let s=n.height?zh(n.position||e||"top-center",n.visible):{opacity:0},i=we.createElement(Uh,{toast:n}),a=we.createElement(Vh,{...n.ariaProps},jn(n.message,n));return we.createElement(Jh,{className:n.className,style:{...s,...t,...n.style}},typeof r=="function"?r({icon:i,message:a}):we.createElement(we.Fragment,null,i,a))}),yh(we.createElement),Ir`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`;const Mn="RFC3986",Nn={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},Yh="RFC1738",Gh=Array.isArray,$e=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),Ln=1024,Kh=(n,e,t,r,s)=>{if(n.length===0)return n;let i=n;if(typeof n=="symbol"?i=Symbol.prototype.toString.call(n):typeof n!="string"&&(i=String(n)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=Ln){const c=i.length>=Ln?i.slice(o,o+Ln):i,l=[];for(let u=0;u<c.length;++u){let h=c.charCodeAt(u);if(h===45||h===46||h===95||h===126||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||s===Yh&&(h===40||h===41)){l[l.length]=c.charAt(u);continue}if(h<128){l[l.length]=$e[h];continue}if(h<2048){l[l.length]=$e[192|h>>6]+$e[128|h&63];continue}if(h<55296||h>=57344){l[l.length]=$e[224|h>>12]+$e[128|h>>6&63]+$e[128|h&63];continue}u+=1,h=65536+((h&1023)<<10|c.charCodeAt(u)&1023),l[l.length]=$e[240|h>>18]+$e[128|h>>12&63]+$e[128|h>>6&63]+$e[128|h&63]}a+=l.join("")}return a};function Xh(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function Yi(n,e){if(Gh(n)){const t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}const Qh=Object.prototype.hasOwnProperty,Gi={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},De=Array.isArray,Zh=Array.prototype.push,Ki=function(n,e){Zh.apply(n,De(e)?e:[e])},ed=Date.prototype.toISOString,ee={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Kh,encodeValuesOnly:!1,format:Mn,formatter:Nn[Mn],indices:!1,serializeDate(n){return ed.call(n)},skipNulls:!1,strictNullHandling:!1};function td(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const Fn={};function Xi(n,e,t,r,s,i,a,o,c,l,u,h,f,m,p,g,_,T){let w=n,S=T,b=0,E=!1;for(;(S=S.get(Fn))!==void 0&&!E;){const I=S.get(n);if(b+=1,typeof I<"u"){if(I===b)throw new RangeError("Cyclic object value");E=!0}typeof S.get(Fn)>"u"&&(b=0)}if(typeof l=="function"?w=l(e,w):w instanceof Date?w=f==null?void 0:f(w):t==="comma"&&De(w)&&(w=Yi(w,function(I){return I instanceof Date?f==null?void 0:f(I):I})),w===null){if(i)return c&&!g?c(e,ee.encoder,_,"key",m):e;w=""}if(td(w)||Xh(w)){if(c){const I=g?e:c(e,ee.encoder,_,"key",m);return[(p==null?void 0:p(I))+"="+(p==null?void 0:p(c(w,ee.encoder,_,"value",m)))]}return[(p==null?void 0:p(e))+"="+(p==null?void 0:p(String(w)))]}const k=[];if(typeof w>"u")return k;let x;if(t==="comma"&&De(w))g&&c&&(w=Yi(w,c)),x=[{value:w.length>0?w.join(",")||null:void 0}];else if(De(l))x=l;else{const I=Object.keys(w);x=u?I.sort(u):I}const W=o?String(e).replace(/\./g,"%2E"):String(e),B=r&&De(w)&&w.length===1?W+"[]":W;if(s&&De(w)&&w.length===0)return B+"[]";for(let I=0;I<x.length;++I){const D=x[I],_e=typeof D=="object"&&typeof D.value<"u"?D.value:w[D];if(a&&_e===null)continue;const ue=h&&o?D.replace(/\./g,"%2E"):D,se=De(w)?typeof t=="function"?t(B,ue):B:B+(h?"."+ue:"["+ue+"]");T.set(n,b);const ce=new WeakMap;ce.set(Fn,T),Ki(k,Xi(_e,se,t,r,s,i,a,o,t==="comma"&&g&&De(w)?null:c,l,u,h,f,m,p,g,_,ce))}return k}function rd(n=ee){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||ee.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Mn;if(typeof n.format<"u"){if(!Qh.call(Nn,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const r=Nn[t];let s=ee.filter;(typeof n.filter=="function"||De(n.filter))&&(s=n.filter);let i;if(n.arrayFormat&&n.arrayFormat in Gi?i=n.arrayFormat:"indices"in n?i=n.indices?"indices":"repeat":i=ee.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:ee.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:ee.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:ee.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:ee.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?ee.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:ee.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:ee.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:ee.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:ee.encodeValuesOnly,filter:s,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:ee.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:ee.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:ee.strictNullHandling}}function nd(n,e={}){let t=n;const r=rd(e);let s,i;typeof r.filter=="function"?(i=r.filter,t=i("",t)):De(r.filter)&&(i=r.filter,s=i);const a=[];if(typeof t!="object"||t===null)return"";const o=Gi[r.arrayFormat],c=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(t)),r.sort&&s.sort(r.sort);const l=new WeakMap;for(let f=0;f<s.length;++f){const m=s[f];r.skipNulls&&t[m]===null||Ki(a,Xi(t[m],m,o,c,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}const u=a.join(r.delimiter);let h=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),u.length>0?h+u:""}const yt="4.76.3";let Qi=!1,Xt,Zi,ea,Un,ta,ra,na,sa,ia;function sd(n,e={auto:!1}){if(Qi)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(Xt)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${Xt}'\``);Qi=e.auto,Xt=n.kind,Zi=n.fetch,ea=n.FormData,Un=n.File,ta=n.ReadableStream,ra=n.getMultipartRequestOptions,na=n.getDefaultAgent,sa=n.fileFromPath,ia=n.isFsReadStream}class id{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function ad({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new id(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}Xt||sd(ad(),{auto:!0});class M extends Error{}class ie extends M{constructor(e,t,r,s){super(`${ie.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=t;const i=t;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new Dr({message:r,cause:Jn(t)});const i=t==null?void 0:t.error;return e===400?new aa(e,i,r,s):e===401?new oa(e,i,r,s):e===403?new ca(e,i,r,s):e===404?new la(e,i,r,s):e===409?new ua(e,i,r,s):e===422?new ha(e,i,r,s):e===429?new da(e,i,r,s):e>=500?new fa(e,i,r,s):new ie(e,i,r,s)}}class Ae extends ie{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Dr extends ie{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class Bn extends Dr{constructor({message:e}={}){super({message:e??"Request timed out."})}}class aa extends ie{}class oa extends ie{}class ca extends ie{}class la extends ie{}class ua extends ie{}class ha extends ie{}class da extends ie{}class fa extends ie{}class ma extends M{constructor(){super("Could not parse response content as the length limit was reached")}}class ga extends M{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class it{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=it.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(it.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new M(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new M(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new M("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}it.NEWLINE_CHARS=new Set([`
`,"\r"]),it.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class Me{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const a of od(e,t))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null){let o;try{o=JSON.parse(a.data)}catch(c){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),c}if(o&&o.error)throw new ie(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(a.data)}catch(c){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),c}if(a.event=="error")throw new ie(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new Me(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){const a=new it,o=pa(e);for await(const c of o)for(const l of a.decode(c))yield l;for(const c of a.flush())yield c}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new Me(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new Me(()=>s(e),this.controller),new Me(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new ta({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=r.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*od(n,e){if(!n.body)throw e.abort(),new M("Attempted to iterate over a response with no body");const t=new ud,r=new it,s=pa(n.body);for await(const i of cd(s))for(const a of r.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of r.flush()){const a=t.decode(i);a&&(yield a)}}async function*cd(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=ld(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function ld(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}class ud{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=hd(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function hd(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function pa(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const _a=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",ya=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Mr(n),Mr=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",dd=n=>ya(n)||_a(n)||ia(n);async function wa(n,e,t){var s;if(n=await n,ya(n))return n;if(_a(n)){const i=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=Mr(i)?[await i.arrayBuffer()]:[i];return new Un(a,e,t)}const r=await fd(n);if(e||(e=gd(n)??"unknown_file"),!(t!=null&&t.type)){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new Un(r,e,t)}async function fd(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(Mr(n))e.push(await n.arrayBuffer());else if(pd(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${md(n)}`);return e}function md(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function gd(n){var e;return Wn(n.name)||Wn(n.filename)||((e=Wn(n.path))==null?void 0:e.split(/[\\/]/).pop())}const Wn=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},pd=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",ba=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",wt=async n=>{const e=await _d(n.body);return ra(e,n)},_d=async n=>{const e=new ea;return await Promise.all(Object.entries(n||{}).map(([t,r])=>qn(e,t,r))),e},qn=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(dd(t)){const r=await wa(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>qn(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>qn(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var bt={},yd=function(n,e,t,r,s){if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t},wd=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Nr;async function va(n){const{response:e}=n;if(n.options.stream)return vt("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):Me.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return vt("response",e.status,e.url,e.headers,i),Sa(i,e)}const s=await e.text();return vt("response",e.status,e.url,e.headers,s),s}function Sa(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class Lr extends Promise{constructor(e,t=va){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new Lr(this.responsePromise,async t=>Sa(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class bd{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Hn("maxRetries",t),this.timeout=Hn("timeout",r),this.httpAgent=s,this.fetch=i??Zi}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Od(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Td()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{const i=s&&Mr(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var g;const{method:r,path:s,query:i,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:ba(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,c=this.calculateContentLength(o),l=this.buildURL(s,i);"timeout"in e&&Hn("timeout",e.timeout);const u=e.timeout??this.timeout,h=e.httpAgent??this.httpAgent??na(l),f=u+1e3;typeof((g=h==null?void 0:h.options)==null?void 0:g.timeout)=="number"&&f>(h.options.timeout??0)&&(h.options.timeout=f),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const m=this.buildHeaders({options:e,headers:a,contentLength:c,retryCount:t});return{req:{method:r,...o&&{body:o},headers:m,...h&&{agent:h},signal:e.signal??null},url:l,timeout:u}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){const i={};r&&(i["content-length"]=r);const a=this.defaultHeaders(e);return Aa(i,a),Aa(i,t),ba(e.body)&&Xt!=="node"&&delete i["content-type"],Ta(a,"x-stainless-retry-count")===void 0&&Ta(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return ie.generate(e,t,r,s)}request(e,t=null){return new Lr(this.makeRequest(e,t))}async makeRequest(e,t){var h,f;const r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);const{req:i,url:a,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:r}),vt("request",a,r,i.headers),(h=r.signal)!=null&&h.aborted)throw new Ae;const c=new AbortController,l=await this.fetchWithTimeout(a,i,o,c).catch(Jn);if(l instanceof Error){if((f=r.signal)!=null&&f.aborted)throw new Ae;if(t)return this.retryRequest(r,t);throw l.name==="AbortError"?new Bn:new Dr({cause:l})}const u=Sd(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){const w=`retrying, ${t} attempts remaining`;return vt(`response (error; ${w})`,l.status,a,u),this.retryRequest(r,t,u)}const m=await l.text().catch(w=>Jn(w).message),p=Pd(m),g=p?void 0:m;throw vt(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,a,u,g),this.makeStatusError(l.status,p,g,u)}return{response:l,options:r,controller:c}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new vd(this,r,e)}buildURL(e,t){const r=Ad(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return Pa(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new M(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r);return this.fetch.call(void 0,e,{signal:s.signal,...a}).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=r==null?void 0:r["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Qt(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${yt}`}}class Ea{constructor(e,t,r,s){Nr.set(this,void 0),yd(this,Nr,e),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new M("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await wd(this,Nr,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Nr=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class vd extends Lr{constructor(e,t,r){super(t,async s=>new r(e,s.response,await va(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const Sd=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),Ed={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},ge=n=>typeof n=="object"&&n!==null&&!Pa(n)&&Object.keys(n).every(e=>Ca(Ed,e)),xd=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yt,"X-Stainless-OS":ka(Deno.build.os),"X-Stainless-Arch":xa(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yt,"X-Stainless-OS":ka(process.platform),"X-Stainless-Arch":xa(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=kd();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":yt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function kd(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const xa=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",ka=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let Oa;const Od=()=>Oa??(Oa=xd()),Pd=n=>{try{return JSON.parse(n)}catch{return}},Cd=/^[a-z][a-z0-9+.-]*:/i,Ad=n=>Cd.test(n),Qt=n=>new Promise(e=>setTimeout(e,n)),Hn=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new M(`${n} must be an integer`);if(e<0)throw new M(`${n} must be a positive integer`);return e},Jn=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)},Fr=n=>{var e,t,r,s;if(typeof process<"u")return((e=bt==null?void 0:bt[n])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(s=(r=(t=Deno.env)==null?void 0:t.get)==null?void 0:r.call(t,n))==null?void 0:s.trim()};function Pa(n){if(!n)return!0;for(const e in n)return!1;return!0}function Ca(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Aa(n,e){for(const t in e){if(!Ca(e,t))continue;const r=t.toLowerCase();if(!r)continue;const s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}function vt(n,...e){typeof process<"u"&&(bt==null?void 0:bt.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}const Td=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),Rd=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",Id=n=>typeof(n==null?void 0:n.get)=="function",Ta=(n,e)=>{var r;const t=e.toLowerCase();if(Id(n)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=n.get(i);if(a)return a}}for(const[s,i]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};function Vn(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}class jd extends Ea{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class Te extends Ea{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var r;const e=this.getPaginatedItems();if(!e.length)return null;const t=(r=e[e.length-1])==null?void 0:r.id;return t?{params:{after:t}}:null}}class J{constructor(e){this._client=e}}let Ra=class extends J{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}},zn=class extends J{constructor(){super(...arguments),this.completions=new Ra(this._client)}};zn.Completions=Ra;class Ia extends J{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}class ja extends J{create(e,t){return this._client.post("/audio/transcriptions",wt({body:e,...t}))}}class $a extends J{create(e,t){return this._client.post("/audio/translations",wt({body:e,...t}))}}let Zt=class extends J{constructor(){super(...arguments),this.transcriptions=new ja(this._client),this.translations=new $a(this._client),this.speech=new Ia(this._client)}};Zt.Transcriptions=ja,Zt.Translations=$a,Zt.Speech=Ia;class Yn extends J{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return ge(e)?this.list({},e):this._client.getAPIList("/batches",Gn,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class Gn extends Te{}Yn.BatchesPage=Gn;class Kn extends J{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return ge(e)?this.list({},e):this._client.getAPIList("/assistants",Xn,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Xn extends Te{}Kn.AssistantsPage=Xn;function Da(n){return typeof n.parse=="function"}const St=n=>(n==null?void 0:n.role)==="assistant",Ma=n=>(n==null?void 0:n.role)==="function",Na=n=>(n==null?void 0:n.role)==="tool";var Re=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},K=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Qn,Ur,Br,er,tr,Wr,rr,Ue,nr,qr,Hr,Et,La;class Fa{constructor(){Qn.add(this),this.controller=new AbortController,Ur.set(this,void 0),Br.set(this,()=>{}),er.set(this,()=>{}),tr.set(this,void 0),Wr.set(this,()=>{}),rr.set(this,()=>{}),Ue.set(this,{}),nr.set(this,!1),qr.set(this,!1),Hr.set(this,!1),Et.set(this,!1),Re(this,Ur,new Promise((e,t)=>{Re(this,Br,e,"f"),Re(this,er,t,"f")}),"f"),Re(this,tr,new Promise((e,t)=>{Re(this,Wr,e,"f"),Re(this,rr,t,"f")}),"f"),K(this,Ur,"f").catch(()=>{}),K(this,tr,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},K(this,Qn,"m",La).bind(this))},0)}_connected(){this.ended||(K(this,Br,"f").call(this),this._emit("connect"))}get ended(){return K(this,nr,"f")}get errored(){return K(this,qr,"f")}get aborted(){return K(this,Hr,"f")}abort(){this.controller.abort()}on(e,t){return(K(this,Ue,"f")[e]||(K(this,Ue,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=K(this,Ue,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(K(this,Ue,"f")[e]||(K(this,Ue,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Re(this,Et,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Re(this,Et,!0,"f"),await K(this,tr,"f")}_emit(e,...t){if(K(this,nr,"f"))return;e==="end"&&(Re(this,nr,!0,"f"),K(this,Wr,"f").call(this));const r=K(this,Ue,"f")[e];if(r&&(K(this,Ue,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!K(this,Et,"f")&&!(r!=null&&r.length)&&Promise.reject(s),K(this,er,"f").call(this,s),K(this,rr,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!K(this,Et,"f")&&!(r!=null&&r.length)&&Promise.reject(s),K(this,er,"f").call(this,s),K(this,rr,"f").call(this,s),this._emit("end")}}_emitFinal(){}}Ur=new WeakMap,Br=new WeakMap,er=new WeakMap,tr=new WeakMap,Wr=new WeakMap,rr=new WeakMap,Ue=new WeakMap,nr=new WeakMap,qr=new WeakMap,Hr=new WeakMap,Et=new WeakMap,Qn=new WeakSet,La=function(e){if(Re(this,qr,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Ae),e instanceof Ae)return Re(this,Hr,!0,"f"),this._emit("abort",e);if(e instanceof M)return this._emit("error",e);if(e instanceof Error){const t=new M(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new M(String(e)))};function Ua(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function sr(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function $d(n,e){return!e||!Ba(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,tool_calls:t.message.tool_calls??[]}}))}:Zn(n,e)}function Zn(n,e){const t=n.choices.map(r=>{var s;if(r.finish_reason==="length")throw new ma;if(r.finish_reason==="content_filter")throw new ga;return{...r,message:{...r.message,tool_calls:((s=r.message.tool_calls)==null?void 0:s.map(i=>Md(e,i)))??[],parsed:r.message.content&&!r.message.refusal?Dd(e,r.message.content):null}}});return{...n,choices:t}}function Dd(n,e){var t,r;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((r=n.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function Md(n,e){var r;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:sr(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function Nd(n,e){var r;if(!n)return!1;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return sr(t)||(t==null?void 0:t.function.strict)||!1}function Ba(n){var e;return Ua(n.response_format)?!0:((e=n.tools)==null?void 0:e.some(t=>sr(t)||t.type==="function"&&t.function.strict===!0))??!1}function Ld(n){for(const e of n??[]){if(e.type!=="function")throw new M(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new M(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var pe=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},oe,es,Jr,ts,rs,ns,Wa,ss;const qa=10;class Ha extends Fa{constructor(){super(...arguments),oe.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Ma(e)||Na(e))&&e.content)this._emit("functionCallResult",e.content);else if(St(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(St(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new M("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),pe(this,oe,"m",es).call(this)}async finalMessage(){return await this.done(),pe(this,oe,"m",Jr).call(this)}async finalFunctionCall(){return await this.done(),pe(this,oe,"m",ts).call(this)}async finalFunctionCallResult(){return await this.done(),pe(this,oe,"m",rs).call(this)}async totalUsage(){return await this.done(),pe(this,oe,"m",ns).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=pe(this,oe,"m",Jr).call(this);t&&this._emit("finalMessage",t);const r=pe(this,oe,"m",es).call(this);r&&this._emit("finalContent",r);const s=pe(this,oe,"m",ts).call(this);s&&this._emit("finalFunctionCall",s);const i=pe(this,oe,"m",rs).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",pe(this,oe,"m",ns).call(this))}async _createChatCompletion(e,t,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),pe(this,oe,"m",Wa).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Zn(i,t))}async _runChatCompletion(e,t,r){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var f;const s="function",{function_call:i="auto",stream:a,...o}=t,c=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:l=qa}=r||{},u={};for(const m of t.functions)u[m.name||m.function.name]=m;const h=t.functions.map(m=>({name:m.name||m.function.name,parameters:m.parameters,description:m.description}));for(const m of t.messages)this._addMessage(m,!1);for(let m=0;m<l;++m){const g=(f=(await this._createChatCompletion(e,{...o,function_call:i,functions:h,messages:[...this.messages]},r)).choices[0])==null?void 0:f.message;if(!g)throw new M("missing message in ChatCompletion response");if(!g.function_call)return;const{name:_,arguments:T}=g.function_call,w=u[_];if(w){if(c&&c!==_){const k=`Invalid function_call: ${JSON.stringify(_)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:s,name:_,content:k});continue}}else{const k=`Invalid function_call: ${JSON.stringify(_)}. Available options are: ${h.map(x=>JSON.stringify(x.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:_,content:k});continue}let S;try{S=Da(w)?await w.parse(T):T}catch(k){this._addMessage({role:s,name:_,content:k instanceof Error?k.message:String(k)});continue}const b=await w.function(S,this),E=pe(this,oe,"m",ss).call(this,b);if(this._addMessage({role:s,name:_,content:E}),c)return}}async _runTools(e,t,r){var m,p,g;const s="tool",{tool_choice:i="auto",stream:a,...o}=t,c=typeof i!="string"&&((m=i==null?void 0:i.function)==null?void 0:m.name),{maxChatCompletions:l=qa}=r||{},u=t.tools.map(_=>{if(sr(_)){if(!_.$callback)throw new M("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:_.$callback,name:_.function.name,description:_.function.description||"",parameters:_.function.parameters,parse:_.$parseRaw,strict:!0}}}return _}),h={};for(const _ of u)_.type==="function"&&(h[_.function.name||_.function.function.name]=_.function);const f="tools"in t?u.map(_=>_.type==="function"?{type:"function",function:{name:_.function.name||_.function.function.name,parameters:_.function.parameters,description:_.function.description,strict:_.function.strict}}:_):void 0;for(const _ of t.messages)this._addMessage(_,!1);for(let _=0;_<l;++_){const w=(p=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:f,messages:[...this.messages]},r)).choices[0])==null?void 0:p.message;if(!w)throw new M("missing message in ChatCompletion response");if(!((g=w.tool_calls)!=null&&g.length))return;for(const S of w.tool_calls){if(S.type!=="function")continue;const b=S.id,{name:E,arguments:k}=S.function,x=h[E];if(x){if(c&&c!==E){const D=`Invalid tool_call: ${JSON.stringify(E)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:s,tool_call_id:b,content:D});continue}}else{const D=`Invalid tool_call: ${JSON.stringify(E)}. Available options are: ${Object.keys(h).map(_e=>JSON.stringify(_e)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:b,content:D});continue}let W;try{W=Da(x)?await x.parse(k):k}catch(D){const _e=D instanceof Error?D.message:String(D);this._addMessage({role:s,tool_call_id:b,content:_e});continue}const B=await x.function(W,this),I=pe(this,oe,"m",ss).call(this,B);if(this._addMessage({role:s,tool_call_id:b,content:I}),c)return}}}}oe=new WeakSet,es=function(){return pe(this,oe,"m",Jr).call(this).content??null},Jr=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(St(t)){const{function_call:r,...s}=t,i={...s,content:t.content??null,refusal:t.refusal??null};return r&&(i.function_call=r),i}}throw new M("stream ended without producing a ChatCompletionMessage with role=assistant")},ts=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if(St(s)&&(s!=null&&s.function_call))return s.function_call;if(St(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},rs=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Ma(t)&&t.content!=null||Na(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},ns=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Wa=function(e){if(e.n!=null&&e.n>1)throw new M("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},ss=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class ir extends Ha{static runFunctions(e,t,r){const s=new ir,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new ir,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e,t=!0){super._addMessage(e,t),St(e)&&e.content&&this._emit("content",e.content)}}const Ja=1,Va=2,za=4,Ya=8,Ga=16,Ka=32,Xa=64,Qa=128,Za=256,eo=Qa|Za,to=Ga|Ka|eo|Xa,ro=Ja|Va|to,no=za|Ya,Fd=ro|no,ne={STR:Ja,NUM:Va,ARR:za,OBJ:Ya,NULL:Ga,BOOL:Ka,NAN:Xa,INFINITY:Qa,MINUS_INFINITY:Za,INF:eo,SPECIAL:to,ATOM:ro,COLLECTION:no,ALL:Fd};class Ud extends Error{}class Bd extends Error{}function Wd(n,e=ne.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return qd(n.trim(),e)}const qd=(n,e)=>{const t=n.length;let r=0;const s=f=>{throw new Ud(`${f} at position ${r}`)},i=f=>{throw new Bd(`${f} at position ${r}`)},a=()=>(h(),r>=t&&s("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?c():n[r]==="["?l():n.substring(r,r+4)==="null"||ne.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||ne.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||ne.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||ne.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||ne.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||ne.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):u()),o=()=>{const f=r;let m=!1;for(r++;r<t&&(n[r]!=='"'||m&&n[r-1]==="\\");)m=n[r]==="\\"?!m:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(f,++r-Number(m)))}catch(p){i(String(p))}else if(ne.STR&e)try{return JSON.parse(n.substring(f,r-Number(m))+'"')}catch{return JSON.parse(n.substring(f,n.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},c=()=>{r++,h();const f={};try{for(;n[r]!=="}";){if(h(),r>=t&&ne.OBJ&e)return f;const m=o();h(),r++;try{const p=a();Object.defineProperty(f,m,{value:p,writable:!0,enumerable:!0,configurable:!0})}catch(p){if(ne.OBJ&e)return f;throw p}h(),n[r]===","&&r++}}catch{if(ne.OBJ&e)return f;s("Expected '}' at end of object")}return r++,f},l=()=>{r++;const f=[];try{for(;n[r]!=="]";)f.push(a()),h(),n[r]===","&&r++}catch{if(ne.ARR&e)return f;s("Expected ']' at end of array")}return r++,f},u=()=>{if(r===0){n==="-"&&ne.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n)}catch(m){if(ne.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}i(String(m))}}const f=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(ne.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(n.substring(f,r))}catch{n.substring(f,r)==="-"&&ne.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n.substring(f,n.lastIndexOf("e")))}catch(p){i(String(p))}}},h=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return a()},so=n=>Wd(n,ne.ALL^ne.NUM);var xt=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},V=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},te,Be,kt,Ke,is,Vr,as,os,cs,zr,ls,io;class ar extends Ha{constructor(e){super(),te.add(this),Be.set(this,void 0),kt.set(this,void 0),Ke.set(this,void 0),xt(this,Be,e,"f"),xt(this,kt,[],"f")}get currentChatCompletionSnapshot(){return V(this,Ke,"f")}static fromReadableStream(e){const t=new ar(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const s=new ar(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){var a;super._createChatCompletion;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),V(this,te,"m",is).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)V(this,te,"m",as).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new Ae;return this._addChatCompletion(V(this,te,"m",zr).call(this))}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),V(this,te,"m",is).call(this),this._connected();const s=Me.fromReadableStream(e,this.controller);let i;for await(const o of s)i&&i!==o.id&&this._addChatCompletion(V(this,te,"m",zr).call(this)),V(this,te,"m",as).call(this,o),i=o.id;if((a=s.controller.signal)!=null&&a.aborted)throw new Ae;return this._addChatCompletion(V(this,te,"m",zr).call(this))}[(Be=new WeakMap,kt=new WeakMap,Ke=new WeakMap,te=new WeakSet,is=function(){this.ended||xt(this,Ke,void 0,"f")},Vr=function(t){let r=V(this,kt,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},V(this,kt,"f")[t.index]=r,r)},as=function(t){var s,i,a,o,c,l,u,h,f,m,p,g,_,T,w;if(this.ended)return;const r=V(this,te,"m",io).call(this,t);this._emit("chunk",t,r);for(const S of t.choices){const b=r.choices[S.index];S.delta.content!=null&&((s=b.message)==null?void 0:s.role)==="assistant"&&((i=b.message)!=null&&i.content)&&(this._emit("content",S.delta.content,b.message.content),this._emit("content.delta",{delta:S.delta.content,snapshot:b.message.content,parsed:b.message.parsed})),S.delta.refusal!=null&&((a=b.message)==null?void 0:a.role)==="assistant"&&((o=b.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:S.delta.refusal,snapshot:b.message.refusal}),((c=S.logprobs)==null?void 0:c.content)!=null&&((l=b.message)==null?void 0:l.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(u=S.logprobs)==null?void 0:u.content,snapshot:((h=b.logprobs)==null?void 0:h.content)??[]}),((f=S.logprobs)==null?void 0:f.refusal)!=null&&((m=b.message)==null?void 0:m.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(p=S.logprobs)==null?void 0:p.refusal,snapshot:((g=b.logprobs)==null?void 0:g.refusal)??[]});const E=V(this,te,"m",Vr).call(this,b);b.finish_reason&&(V(this,te,"m",cs).call(this,b),E.current_tool_call_index!=null&&V(this,te,"m",os).call(this,b,E.current_tool_call_index));for(const k of S.delta.tool_calls??[])E.current_tool_call_index!==k.index&&(V(this,te,"m",cs).call(this,b),E.current_tool_call_index!=null&&V(this,te,"m",os).call(this,b,E.current_tool_call_index)),E.current_tool_call_index=k.index;for(const k of S.delta.tool_calls??[]){const x=(_=b.message.tool_calls)==null?void 0:_[k.index];x!=null&&x.type&&((x==null?void 0:x.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(T=x.function)==null?void 0:T.name,index:k.index,arguments:x.function.arguments,parsed_arguments:x.function.parsed_arguments,arguments_delta:((w=k.function)==null?void 0:w.arguments)??""}):(x==null||x.type,void 0))}}},os=function(t,r){var a,o,c;if(V(this,te,"m",Vr).call(this,t).done_tool_calls.has(r))return;const i=(a=t.message.tool_calls)==null?void 0:a[r];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){const l=(c=(o=V(this,Be,"f"))==null?void 0:o.tools)==null?void 0:c.find(u=>u.type==="function"&&u.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:r,arguments:i.function.arguments,parsed_arguments:sr(l)?l.$parseRaw(i.function.arguments):l!=null&&l.function.strict?JSON.parse(i.function.arguments):null})}else i.type},cs=function(t){var s,i;const r=V(this,te,"m",Vr).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;const a=V(this,te,"m",ls).call(this);this._emit("content.done",{content:t.message.content,parsed:a?a.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(i=t.logprobs)!=null&&i.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},zr=function(){if(this.ended)throw new M("stream has ended, this shouldn't happen");const t=V(this,Ke,"f");if(!t)throw new M("request ended without sending any chunks");return xt(this,Ke,void 0,"f"),xt(this,kt,[],"f"),Hd(t,V(this,Be,"f"))},ls=function(){var r;const t=(r=V(this,Be,"f"))==null?void 0:r.response_format;return Ua(t)?t:null},io=function(t){var r,s,i,a;let o=V(this,Ke,"f");const{choices:c,...l}=t;o?Object.assign(o,l):o=xt(this,Ke,{...l,choices:[]},"f");for(const{delta:u,finish_reason:h,index:f,logprobs:m=null,...p}of t.choices){let g=o.choices[f];if(g||(g=o.choices[f]={finish_reason:h,index:f,message:{},logprobs:m,...p}),m)if(!g.logprobs)g.logprobs=Object.assign({},m);else{const{content:k,refusal:x,...W}=m;Object.assign(g.logprobs,W),k&&((r=g.logprobs).content??(r.content=[]),g.logprobs.content.push(...k)),x&&((s=g.logprobs).refusal??(s.refusal=[]),g.logprobs.refusal.push(...x))}if(h&&(g.finish_reason=h,V(this,Be,"f")&&Ba(V(this,Be,"f")))){if(h==="length")throw new ma;if(h==="content_filter")throw new ga}if(Object.assign(g,p),!u)continue;const{content:_,refusal:T,function_call:w,role:S,tool_calls:b,...E}=u;if(Object.assign(g.message,E),T&&(g.message.refusal=(g.message.refusal||"")+T),S&&(g.message.role=S),w&&(g.message.function_call?(w.name&&(g.message.function_call.name=w.name),w.arguments&&((i=g.message.function_call).arguments??(i.arguments=""),g.message.function_call.arguments+=w.arguments)):g.message.function_call=w),_&&(g.message.content=(g.message.content||"")+_,!g.message.refusal&&V(this,te,"m",ls).call(this)&&(g.message.parsed=so(g.message.content))),b){g.message.tool_calls||(g.message.tool_calls=[]);for(const{index:k,id:x,type:W,function:B,...I}of b){const D=(a=g.message.tool_calls)[k]??(a[k]={});Object.assign(D,I),x&&(D.id=x),W&&(D.type=W),B&&(D.function??(D.function={name:B.name??"",arguments:""})),B!=null&&B.name&&(D.function.name=B.name),B!=null&&B.arguments&&(D.function.arguments+=B.arguments,Nd(V(this,Be,"f"),D)&&(D.function.parsed_arguments=so(D.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Me(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Hd(n,e){const{id:t,choices:r,created:s,model:i,system_fingerprint:a,...o}=n,c={...o,id:t,choices:r.map(({message:l,finish_reason:u,index:h,logprobs:f,...m})=>{if(!u)throw new M(`missing finish_reason for choice ${h}`);const{content:p=null,function_call:g,tool_calls:_,...T}=l,w=l.role;if(!w)throw new M(`missing role for choice ${h}`);if(g){const{arguments:S,name:b}=g;if(S==null)throw new M(`missing function_call.arguments for choice ${h}`);if(!b)throw new M(`missing function_call.name for choice ${h}`);return{...m,message:{content:p,function_call:{arguments:S,name:b},role:w,refusal:l.refusal??null},finish_reason:u,index:h,logprobs:f}}return _?{...m,index:h,finish_reason:u,logprobs:f,message:{...T,role:w,content:p,refusal:l.refusal??null,tool_calls:_.map((S,b)=>{const{function:E,type:k,id:x,...W}=S,{arguments:B,name:I,...D}=E||{};if(x==null)throw new M(`missing choices[${h}].tool_calls[${b}].id
${Yr(n)}`);if(k==null)throw new M(`missing choices[${h}].tool_calls[${b}].type
${Yr(n)}`);if(I==null)throw new M(`missing choices[${h}].tool_calls[${b}].function.name
${Yr(n)}`);if(B==null)throw new M(`missing choices[${h}].tool_calls[${b}].function.arguments
${Yr(n)}`);return{...W,id:x,type:k,function:{...D,name:I,arguments:B}}})}}:{...m,message:{...T,content:p,role:w,refusal:l.refusal??null},finish_reason:u,index:h,logprobs:f}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return $d(c,e)}function Yr(n){return JSON.stringify(n)}function Lf(n){}class Ot extends ar{static fromReadableStream(e){const t=new Ot(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){const s=new Ot(null),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new Ot(t),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}}let ao=class extends J{parse(e,t){return Ld(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>Zn(r,e))}runFunctions(e,t){return e.stream?Ot.runFunctions(this._client,e,t):ir.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Ot.runTools(this._client,e,t):ir.runTools(this._client,e,t)}stream(e,t){return ar.createChatCompletion(this._client,e,t)}};class us extends J{constructor(){super(...arguments),this.completions=new ao(this._client)}}(function(n){n.Completions=ao})(us||(us={}));var P=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},ve=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},ae,hs,Ne,Gr,Ie,at,Pt,ot,Kr,Se,Xr,Qr,or,cr,lr,oo,co,lo,uo,ho,fo,mo;class je extends Fa{constructor(){super(...arguments),ae.add(this),hs.set(this,[]),Ne.set(this,{}),Gr.set(this,{}),Ie.set(this,void 0),at.set(this,void 0),Pt.set(this,void 0),ot.set(this,void 0),Kr.set(this,void 0),Se.set(this,void 0),Xr.set(this,void 0),Qr.set(this,void 0),or.set(this,void 0)}[(hs=new WeakMap,Ne=new WeakMap,Gr=new WeakMap,Ie=new WeakMap,at=new WeakMap,Pt=new WeakMap,ot=new WeakMap,Kr=new WeakMap,Se=new WeakMap,Xr=new WeakMap,Qr=new WeakMap,or=new WeakMap,ae=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new je;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=Me.fromReadableStream(e,this.controller);for await(const a of s)P(this,ae,"m",cr).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new Ae;return this._addRun(P(this,ae,"m",lr).call(this))}toReadableStream(){return new Me(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s,i){const a=new je;return a._run(()=>a._runToolAssistantStream(e,t,r,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,r,s,i){var l;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},c=await e.submitToolOutputs(t,r,o,{...i,signal:this.controller.signal});this._connected();for await(const u of c)P(this,ae,"m",cr).call(this,u);if((l=c.controller.signal)!=null&&l.aborted)throw new Ae;return this._addRun(P(this,ae,"m",lr).call(this))}static createThreadAssistantStream(e,t,r){const s=new je;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){const i=new je;return i._run(()=>i._runAssistantStream(e,t,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return P(this,Xr,"f")}currentRun(){return P(this,Qr,"f")}currentMessageSnapshot(){return P(this,Ie,"f")}currentRunStepSnapshot(){return P(this,or,"f")}async finalRunSteps(){return await this.done(),Object.values(P(this,Ne,"f"))}async finalMessages(){return await this.done(),Object.values(P(this,Gr,"f"))}async finalRun(){if(await this.done(),!P(this,at,"f"))throw Error("Final run was not received.");return P(this,at,"f")}async _createThreadAssistantStream(e,t,r){var o;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},a=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(const c of a)P(this,ae,"m",cr).call(this,c);if((o=a.controller.signal)!=null&&o.aborted)throw new Ae;return this._addRun(P(this,ae,"m",lr).call(this))}async _createAssistantStream(e,t,r,s){var c;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(const l of o)P(this,ae,"m",cr).call(this,l);if((c=o.controller.signal)!=null&&c.aborted)throw new Ae;return this._addRun(P(this,ae,"m",lr).call(this))}static accumulateDelta(e,t){for(const[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let i=e[r];if(i==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(Vn(i)&&Vn(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(const a of s){if(!Vn(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const c=i[o];c==null?i.push(a):i[o]=this.accumulateDelta(c,a)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${i}`);e[r]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s,i){return await this._createToolAssistantStream(r,e,t,s,i)}}cr=function(e){if(!this.ended)switch(ve(this,Xr,e,"f"),P(this,ae,"m",lo).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":P(this,ae,"m",mo).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":P(this,ae,"m",co).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":P(this,ae,"m",oo).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},lr=function(){if(this.ended)throw new M("stream has ended, this shouldn't happen");if(!P(this,at,"f"))throw Error("Final run has not been received");return P(this,at,"f")},oo=function(e){const[t,r]=P(this,ae,"m",ho).call(this,e,P(this,Ie,"f"));ve(this,Ie,t,"f"),P(this,Gr,"f")[t.id]=t;for(const s of r){const i=t.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=P(this,Pt,"f")){if(P(this,ot,"f"))switch(P(this,ot,"f").type){case"text":this._emit("textDone",P(this,ot,"f").text,P(this,Ie,"f"));break;case"image_file":this._emit("imageFileDone",P(this,ot,"f").image_file,P(this,Ie,"f"));break}ve(this,Pt,s.index,"f")}ve(this,ot,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(P(this,Pt,"f")!==void 0){const s=e.data.content[P(this,Pt,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,P(this,Ie,"f"));break;case"text":this._emit("textDone",s.text,P(this,Ie,"f"));break}}P(this,Ie,"f")&&this._emit("messageDone",e.data),ve(this,Ie,void 0,"f")}},co=function(e){const t=P(this,ae,"m",uo).call(this,e);switch(ve(this,or,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of r.step_details.tool_calls)i.index==P(this,Kr,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(P(this,Se,"f")&&this._emit("toolCallDone",P(this,Se,"f")),ve(this,Kr,i.index,"f"),ve(this,Se,t.step_details.tool_calls[i.index],"f"),P(this,Se,"f")&&this._emit("toolCallCreated",P(this,Se,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ve(this,or,void 0,"f"),e.data.step_details.type=="tool_calls"&&P(this,Se,"f")&&(this._emit("toolCallDone",P(this,Se,"f")),ve(this,Se,void 0,"f")),this._emit("runStepDone",e.data,t);break}},lo=function(e){P(this,hs,"f").push(e),this._emit("event",e)},uo=function(e){switch(e.event){case"thread.run.step.created":return P(this,Ne,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=P(this,Ne,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const s=je.accumulateDelta(t,r.delta);P(this,Ne,"f")[e.data.id]=s}return P(this,Ne,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":P(this,Ne,"f")[e.data.id]=e.data;break}if(P(this,Ne,"f")[e.data.id])return P(this,Ne,"f")[e.data.id];throw new Error("No snapshot available")},ho=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=P(this,ae,"m",fo).call(this,i,a)}else t.content[i.index]=i,r.push(i);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},fo=function(e,t){return je.accumulateDelta(t,e)},mo=function(e){switch(ve(this,Qr,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":ve(this,at,e.data,"f"),P(this,Se,"f")&&(this._emit("toolCallDone",P(this,Se,"f")),ve(this,Se,void 0,"f"));break}};class ds extends J{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return ge(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,fs,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class fs extends Te{}ds.MessagesPage=fs;class ms extends J{retrieve(e,t,r,s={},i){return ge(s)?this.retrieve(e,t,r,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t,r={},s){return ge(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,gs,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class gs extends Te{}ms.RunStepsPage=gs;class ur extends J{constructor(){super(...arguments),this.steps=new ms(this._client)}create(e,t,r){const{include:s,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:i,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return ge(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,ps,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}createAndStream(e,t,r){return je.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const c=a.headers.get("openai-poll-after-ms");if(c){const l=parseInt(c);isNaN(l)||(o=l)}}await Qt(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,r){return je.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,s){const i=await this.submitToolOutputs(e,t,r,s);return await this.poll(e,i.id,s)}submitToolOutputsStream(e,t,r,s){return je.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,s)}}class ps extends Te{}ur.RunsPage=ps,ur.Steps=ms,ur.RunStepsPage=gs;class Ct extends J{constructor(){super(...arguments),this.runs=new ur(this._client),this.messages=new ds(this._client)}create(e={},t){return ge(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return je.createThreadAssistantStream(e,this._client.beta.threads,t)}}Ct.Runs=ur,Ct.RunsPage=ps,Ct.Messages=ds,Ct.MessagesPage=fs;const Jd=async n=>{const e=await Promise.allSettled(n),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const r=[];for(const s of e)s.status==="fulfilled"&&r.push(s.value);return r};let _s=class extends J{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},r){return ge(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Zr,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const i=await this.retrieve(e,t,{...r,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const c=i.response.headers.get("openai-poll-after-ms");if(c){const l=parseInt(c);isNaN(l)||(o=l)}}await Qt(o);break;case"failed":case"completed":return a}}}async upload(e,t,r){const s=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,t,r){const s=await this.upload(e,t,r);return await this.poll(e,s.id,r)}};class Zr extends Te{}_s.VectorStoreFilesPage=Zr;class go extends J{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t);return await this.poll(e,s.id,r)}listFiles(e,t,r={},s){return ge(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Zr,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:s}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const c=a.headers.get("openai-poll-after-ms");if(c){const l=parseInt(c);isNaN(l)||(o=l)}}await Qt(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(s==null?void 0:s.maxConcurrency)??5,a=Math.min(i,t.length),o=this._client,c=t.values(),l=[...r];async function u(f){for(let m of f){const p=await o.files.create({file:m,purpose:"assistants"},s);l.push(p.id)}}const h=Array(a).fill(c).map(u);return await Jd(h),await this.createAndPoll(e,{file_ids:l})}}class At extends J{constructor(){super(...arguments),this.files=new _s(this._client),this.fileBatches=new go(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return ge(e)?this.list({},e):this._client.getAPIList("/vector_stores",ys,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class ys extends Te{}At.VectorStoresPage=ys,At.Files=_s,At.VectorStoreFilesPage=Zr,At.FileBatches=go;class ct extends J{constructor(){super(...arguments),this.vectorStores=new At(this._client),this.chat=new us(this._client),this.assistants=new Kn(this._client),this.threads=new Ct(this._client)}}ct.VectorStores=At,ct.VectorStoresPage=ys,ct.Assistants=Kn,ct.AssistantsPage=Xn,ct.Threads=Ct;class po extends J{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class _o extends J{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}class ws extends J{create(e,t){return this._client.post("/files",wt({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return ge(e)?this.list({},e):this._client.getAPIList("/files",bs,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await Qt(t),a=await this.retrieve(e),Date.now()-i>r)throw new Bn({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}}class bs extends Te{}ws.FileObjectsPage=bs;class vs extends J{list(e,t={},r){return ge(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Ss,{query:t,...r})}}class Ss extends Te{}vs.FineTuningJobCheckpointsPage=Ss;class Tt extends J{constructor(){super(...arguments),this.checkpoints=new vs(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return ge(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Es,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return ge(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,xs,{query:t,...r})}}class Es extends Te{}class xs extends Te{}Tt.FineTuningJobsPage=Es,Tt.FineTuningJobEventsPage=xs,Tt.Checkpoints=vs,Tt.FineTuningJobCheckpointsPage=Ss;class hr extends J{constructor(){super(...arguments),this.jobs=new Tt(this._client)}}hr.Jobs=Tt,hr.FineTuningJobsPage=Es,hr.FineTuningJobEventsPage=xs;class yo extends J{createVariation(e,t){return this._client.post("/images/variations",wt({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",wt({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class ks extends J{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Os,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Os extends jd{}ks.ModelsPage=Os;class wo extends J{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class bo extends J{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,wt({body:t,...r}))}}class Ps extends J{constructor(){super(...arguments),this.parts=new bo(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}}Ps.Parts=bo;var vo;class F extends bd{constructor({baseURL:e=Fr("OPENAI_BASE_URL"),apiKey:t=Fr("OPENAI_API_KEY"),organization:r=Fr("OPENAI_ORG_ID")??null,project:s=Fr("OPENAI_PROJECT_ID")??null,...i}={}){if(t===void 0)throw new M("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:r,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&Rd())throw new M(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new po(this),this.chat=new zn(this),this.embeddings=new _o(this),this.files=new ws(this),this.images=new yo(this),this.audio=new Zt(this),this.moderations=new wo(this),this.models=new ks(this),this.fineTuning=new hr(this),this.beta=new ct(this),this.batches=new Yn(this),this.uploads=new Ps(this),this._options=a,this.apiKey=t,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return nd(e,{arrayFormat:"brackets"})}}vo=F,F.OpenAI=vo,F.DEFAULT_TIMEOUT=6e5,F.OpenAIError=M,F.APIError=ie,F.APIConnectionError=Dr,F.APIConnectionTimeoutError=Bn,F.APIUserAbortError=Ae,F.NotFoundError=la,F.ConflictError=ua,F.RateLimitError=da,F.BadRequestError=aa,F.AuthenticationError=oa,F.InternalServerError=fa,F.PermissionDeniedError=ca,F.UnprocessableEntityError=ha,F.toFile=wa,F.fileFromPath=sa,F.Completions=po,F.Chat=zn,F.Embeddings=_o,F.Files=ws,F.FileObjectsPage=bs,F.Images=yo,F.Audio=Zt,F.Moderations=wo,F.Models=ks,F.ModelsPage=Os,F.FineTuning=hr,F.Beta=ct,F.Batches=Yn,F.BatchesPage=Gn,F.Uploads=Ps;var Vd={};new F({apiKey:Vd.OPENAI_API_KEY||""});const zd=async(n,e)=>{try{const t=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:n,conversationId:e})});if(!t.ok)throw new Error("Failed to generate response");return(await t.json()).response}catch(t){return console.error("Error generating response:",t),"Sorry, I encountered an error while processing your request."}},Yd=hh((n,e)=>({isLoading:!1,error:null,sendMessage:async(t,r)=>{n({isLoading:!0,error:null});try{console.log("Sending user message from widget:",t);const s={conversation_id:r,content:t,sender_type:"user",user_id:null},{error:i}=await Q.from("messages").insert(s);if(i)throw i;const{data:a,error:o}=await Q.from("conversations").select("live_mode").eq("id",r).single();if(o)throw o;if(a.live_mode)console.log("Live mode enabled, skipping OpenAI response");else{console.log("Live mode disabled, generating OpenAI response");try{const l=await zd(t,r);console.log("Got OpenAI response:",l);const u={conversation_id:r,content:l,sender_type:"bot",user_id:null},{error:h}=await Q.from("messages").insert(u);if(h)throw h}catch(l){console.error("Error generating bot response:",l),xe.error("Failed to generate bot response")}}const{error:c}=await Q.from("conversations").update({last_message_at:new Date().toISOString()}).eq("id",r);if(c)throw c}catch(s){console.error("Error sending message:",s),n({error:s.message}),xe.error("Failed to send message")}finally{n({isLoading:!1})}}})),So="chatbot_session_id",Gd=180;function Kd({domainId:n}){const[e,t]=j.useState(!1),[r,s]=j.useState(""),[i,a]=j.useState([]),[o,c]=j.useState([]),[l,u]=j.useState("history"),[h,f]=j.useState(null),[m,p]=j.useState(!1),[g]=j.useState(new Set),[_,T]=j.useState(null),[w,S]=j.useState(null),b=j.useRef(null),[E,k]=j.useState(!1),x=j.useRef(null),{sendMessage:W}=Yd();j.useEffect(()=>{if(!w)return;const C=Q.channel("new-conversations").on("postgres_changes",{event:"INSERT",schema:"public",table:"conversations",filter:`session_id=eq.${w}`},O=>{O.eventType==="INSERT"&&c(G=>[O.new,...G])}).subscribe();return()=>{C.unsubscribe()}},[w]),j.useEffect(()=>{if(!w)return;const C=Q.channel("conversations-updates").on("postgres_changes",{event:"*",schema:"public",table:"conversations",filter:`session_id=eq.${w}`},O=>{O.eventType==="UPDATE"&&(c(G=>G.map(he=>he.id===O.new.id?{...he,...O.new}:he)),O.new.id===h&&k(O.new.status==="archived"))}).subscribe();return()=>{C.unsubscribe()}},[w,h]),j.useEffect(()=>{var C;(C=b.current)==null||C.scrollIntoView({behavior:"smooth"})},[i]);const B=async()=>{if(w)try{const{data:C,error:O}=await Q.from("conversations").select("*").eq("session_id",w).order("last_message_at",{ascending:!1});if(O)throw O;c(C||[])}catch(C){console.error("Error loading conversation history:",C)}};j.useEffect(()=>{w&&B()},[w]);const I=async()=>{a([]),f(null),k(!1),u("chat")},D=()=>{u("history"),a([]),f(null),k(!1)},_e=async C=>{try{f(C.id),k(C.status==="archived");const{data:O}=await Q.from("messages").select("*").eq("conversation_id",C.id).order("created_at",{ascending:!0});O&&(a(O),g.clear(),O.forEach(G=>g.add(G.id))),u("chat")}catch(O){console.error("Error loading conversation:",O)}};j.useEffect(()=>{if(!h)return;const C=Q.channel(`conversation-status:${h}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"conversations",filter:`id=eq.${h}`},O=>{O.new.status==="archived"?(k(!0),ue()):k(!1)}).subscribe();return()=>{C.unsubscribe()}},[h]),j.useEffect(()=>{x.current=new Audio("https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3")},[]);const ue=()=>{x.current&&(x.current.currentTime=0,x.current.play().catch(C=>{console.log("Error playing notification:",C)}))};j.useEffect(()=>{if(!h){console.log("No conversation ID yet, skipping subscription");return}console.log("Setting up subscription for conversation:",h);const C=Q.channel("messages").on("postgres_changes",{event:"*",schema:"public",table:"messages",filter:`conversation_id=eq.${h}`},O=>{if(console.log("Received real-time event:",O),O.eventType==="INSERT"){const G=O.new;console.log("New message:",G),a(he=>g.has(G.id)?(console.log("Message already exists, skipping"),he):(g.add(G.id),G.sender_type==="bot"&&e&&ue(),console.log("Adding new message to state"),[...he,G]))}});return C.subscribe(O=>{console.log("Subscription status:",O),O==="SUBSCRIBED"?console.log("Successfully subscribed to messages"):O==="CLOSED"?console.log("Subscription closed"):O==="CHANNEL_ERROR"&&console.error("Subscription error")}),()=>{console.log("Cleaning up subscription for conversation:",h),C.unsubscribe()}},[h,e]),j.useEffect(()=>{(async()=>{let O=localStorage.getItem(So);O||(O=window.crypto.randomUUID(),localStorage.setItem(So,O)),S(O),await se(O)})()},[]);const se=async C=>{try{const{data:O,error:G}=await Q.from("conversations").select("*").eq("session_id",C).eq("status","active").order("last_message_at",{ascending:!1}).limit(1).single();if(G){if(G.code==="PGRST116")return;throw G}const he=new Date;if(he.setDate(he.getDate()-Gd),new Date(O.last_message_at)<he){await Q.from("conversations").update({status:"archived"}).eq("id",O.id);return}f(O.id);const{data:en}=await Q.from("messages").select("*").eq("conversation_id",O.id).order("created_at",{ascending:!0});if(en){const Cs=en.filter(jt=>g.has(jt.id)?!1:(g.add(jt.id),!0));a(Cs)}}catch(O){console.error("Error loading existing conversation:",O),T("Failed to load conversation history")}},ce=async()=>{try{const{data:{user:C}}=await Q.auth.getUser();if(!C){await Q.auth.signInAnonymously();const{data:{user:he}}=await Q.auth.getUser();if(!he)throw new Error("Failed to create anonymous session")}const{data:O,error:G}=await Q.from("conversations").insert({domain_id:n,user_id:C.id,session_id:w,last_message_at:new Date().toISOString(),status:"active"}).select().single();if(G)throw G;return O.id}catch(C){throw console.error("Error creating conversation:",C),C}},We=async C=>{try{p(!0),T(null);const{data:{user:O}}=await Q.auth.getUser();O||await Q.auth.signInAnonymously();const G=h||await ce();h||f(G),await W(C,G),s("")}catch(O){console.error("Error sending message:",O),T("Failed to send message. Please try again.")}finally{p(!1)}},Xe=async C=>{C.preventDefault(),!(!r.trim()||m)&&await We(r.trim())};j.useEffect(()=>{n&&(async()=>{try{const{data:O}=await Q.from("domain_settings").select("*").eq("domain_id",n).single();Rt(O?{chatbotName:O.chatbot_name,greetingMessage:O.greeting_message||"Hello! How can I help you today?",color:O.primary_color||"#FF6B00",headerTextColor:O.header_text_color||"#000000"}:{chatbotName:"Friendly Assistant",greetingMessage:"Hello! How can I help you today?",color:"#FF6B00",headerTextColor:"#000000"})}catch(O){console.error("Error fetching chatbot config:",O),Rt({chatbotName:"Friendly Assistant",greetingMessage:"Hello! How can I help you today?",color:"#FF6B00",headerTextColor:"#000000"})}})()},[n]);const[le,Rt]=j.useState({chatbotName:"Chatbot",greetingMessage:"Hello! How can I help you today?",color:"#FF6B00",headerTextColor:"#000000"}),It={backgroundColor:le.color};return A.jsxs("div",{className:"fixed bottom-6 right-6 flex flex-col items-end z-[9999]",children:[e&&A.jsxs("div",{className:"mb-4 w-[380px] bg-white rounded-lg shadow-xl border border-gray-200 overflow-hidden",children:[A.jsxs("div",{className:"p-4 border-b flex items-center gap-3",style:{backgroundColor:le.color},children:[A.jsxs("div",{className:"relative flex-shrink-0",children:[A.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:A.jsx("span",{className:"text-lg",children:"🤖"})}),A.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-white",style:It})]}),A.jsxs("div",{className:"flex-1",children:[A.jsx("h3",{className:"font-medium",style:{color:le.headerTextColor},children:le.chatbotName}),A.jsxs("p",{className:"text-sm",style:{color:le.headerTextColor},children:["from ",le.chatbotName]})]}),l==="chat"&&A.jsxs("button",{onClick:D,className:"flex items-center gap-1 px-3 py-1.5 bg-white/20 rounded-lg text-sm",style:{color:le.headerTextColor},children:[A.jsx(Yo,{className:"h-4 w-4"}),"History"]})]}),A.jsx("div",{className:"h-[400px] overflow-y-auto p-4 bg-gray-50 relative",children:l==="history"?A.jsxs("div",{className:"space-y-4 h-full",children:[A.jsxs("div",{className:"flex justify-between items-center mb-4",children:[A.jsx("h3",{className:"font-medium text-gray-900",children:"Conversation History"}),A.jsxs("button",{onClick:I,className:"flex items-center gap-2 px-3 py-1.5 bg-orange-500 text-white text-sm rounded-lg hover:bg-orange-600",children:[A.jsx(zo,{className:"h-4 w-4"}),"Start New Chat"]})]}),o.map(C=>A.jsxs("button",{onClick:()=>_e(C),className:"w-full text-left p-4 rounded-lg hover:bg-gray-100 transition-colors border border-gray-200",children:[A.jsxs("div",{className:"flex justify-between items-center mb-1",children:[A.jsx("span",{className:"text-sm font-medium text-gray-900",children:Tr(new Date(C.created_at),"PPP")}),A.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${C.status==="archived"?"bg-gray-100 text-gray-600":"bg-green-100 text-green-600"}`,children:C.status==="archived"?"Archived":"Active"})]}),A.jsxs("p",{className:"text-sm text-gray-600",children:["Last message: ",Tr(new Date(C.last_message_at),"p")]})]},C.id)),o.length===0&&A.jsx("div",{className:"flex flex-col items-center justify-center h-full text-center",children:A.jsx("p",{className:"mb-4",children:"No previous conversations found"})})]}):A.jsxs("div",{className:"space-y-4",children:[l==="chat"&&A.jsxs("div",{className:"flex gap-2",children:[A.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-100 flex-shrink-0 flex items-center justify-center",children:"🤖"}),A.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-sm max-w-[80%]",children:[A.jsx("p",{className:"text-sm",children:le.greetingMessage}),A.jsx("span",{className:"text-xs text-gray-500 mt-1 block",children:Tr(new Date,"h:mm a")})]})]}),i.map(C=>A.jsxs("div",{className:`flex gap-2 ${C.sender_type==="user"?"justify-end":""}`,children:[C.sender_type==="bot"&&A.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-100 flex-shrink-0 flex items-center justify-center",children:"🤖"}),A.jsxs("div",{className:`p-3 rounded-lg max-w-[80%] ${C.sender_type==="user"?"bg-orange-500 text-white ml-auto":"bg-white shadow-sm"}`,children:[A.jsx("p",{className:"text-sm",children:C.content}),A.jsx("span",{className:`text-xs mt-1 block ${C.sender_type==="user"?"text-orange-100":"text-gray-500"}`,children:Tr(new Date(C.created_at),"h:mm a")})]}),C.sender_type==="user"&&A.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-100 flex-shrink-0 flex items-center justify-center",children:"👤"})]},C.id)),E&&A.jsx("div",{className:"flex justify-center",children:A.jsxs("div",{className:"bg-gray-100 rounded-lg px-4 py-3 flex items-center gap-2 text-gray-600",children:[A.jsx(Vo,{className:"h-4 w-4"}),A.jsx("span",{className:"text-sm",children:"This conversation has been archived"})]})}),A.jsx("div",{ref:b})]})}),l==="chat"&&A.jsxs("form",{onSubmit:Xe,className:"p-4 border-t bg-white",children:[A.jsxs("div",{className:"flex gap-2",children:[A.jsx("div",{className:"flex-1 relative",children:A.jsx("input",{type:"text",value:r,onChange:C=>s(C.target.value),placeholder:"Type your message...",className:"w-full px-4 py-2 border rounded-full focus:outline-none focus:ring-2 pr-10 disabled:opacity-50 disabled:cursor-not-allowed",style:{"--tw-ring-color":le.color},disabled:m||E})}),A.jsx("button",{type:"submit",disabled:!r.trim()||m||E,className:"p-2 rounded-full text-white flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed",style:It,children:m?A.jsx("div",{className:"h-5 w-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):A.jsx(Go,{className:"h-5 w-5"})})]}),A.jsx("div",{className:"text-center mt-2",children:A.jsx("a",{href:"https://dashboard.ai",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-gray-600 hover:text-gray-700",children:"Powered by Dashboard.ai"})})]})]}),A.jsx("button",{className:"w-14 h-14 rounded-full text-white flex items-center justify-center shadow-lg",style:It,onClick:()=>t(!e),children:e?"×":"💬"})]})}function Xd(){const n=document.createElement("div");n.id="chatbot-widget-root",document.body.appendChild(n);const e=window.CHATBOT_CONFIG||{};on(n).render(A.jsx(Kd,{domainId:e.domainId}))}Xd();var Qd=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")};const Zd=Object.freeze(Object.defineProperty({__proto__:null,default:Ns(Qd)},Symbol.toStringTag,{value:"Module"}))});
//# sourceMappingURL=chatbot-widget.umd.js.map
